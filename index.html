<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trisend ‚Äì QR & Link Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script src="https://js.paystack.co/v1/inline.js"></script>
<style>
:root{--bg:#060B18;--bg2:#0C1225;--bg3:#111827;--card:#0F1829;--border:rgba(124,58,237,.18);--border2:rgba(255,255,255,.06);--primary:#7C3AED;--primary-light:#9F67FF;--cyan:#06B6D4;--green:#10B981;--red:#EF4444;--yellow:#F59E0B;--text:#F1F5F9;--text2:#94A3B8;--text3:#64748B;--grad:linear-gradient(135deg,#7C3AED,#06B6D4);--grad2:linear-gradient(135deg,#7C3AED 0%,#4F46E5 50%,#06B6D4 100%);--shadow:0 8px 32px rgba(124,58,237,.2);--r:16px;--r2:12px;--r3:8px;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}
::-webkit-scrollbar{width:4px;}::-webkit-scrollbar-track{background:var(--bg2);}::-webkit-scrollbar-thumb{background:var(--primary);border-radius:4px;}
.hidden{display:none!important;}
/* ‚îÄ‚îÄ LOADER ‚îÄ‚îÄ */
#globalLoader{position:fixed;inset:0;background:var(--bg);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px;}
.loader-logo{animation:breathe 2.2s ease-in-out infinite;}
@keyframes breathe{0%,100%{transform:scale(1);filter:drop-shadow(0 0 12px #7C3AED88);}50%{transform:scale(1.08);filter:drop-shadow(0 0 28px #7C3AEDcc);}}
.loader-dots{display:flex;gap:8px;}
.loader-dot{width:8px;height:8px;border-radius:50%;background:var(--primary);animation:dotBounce 1.4s ease-in-out infinite;}
.loader-dot:nth-child(2){animation-delay:.2s;background:var(--primary-light);}
.loader-dot:nth-child(3){animation-delay:.4s;background:var(--cyan);}
@keyframes dotBounce{0%,80%,100%{transform:scale(0.6);opacity:.4;}40%{transform:scale(1);opacity:1;}}
/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toastContainer{position:fixed;top:20px;right:20px;z-index:9998;display:flex;flex-direction:column;gap:10px;}
.toast{padding:14px 20px;border-radius:var(--r3);backdrop-filter:blur(16px);border:1px solid var(--border2);font-size:14px;font-weight:500;min-width:260px;animation:slideIn .3s ease;display:flex;align-items:center;gap:10px;}
.toast.success{background:rgba(16,185,129,.15);border-color:rgba(16,185,129,.3);color:#6EE7B7;}
.toast.error{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.3);color:#FCA5A5;}
.toast.info{background:rgba(124,58,237,.15);border-color:var(--border);color:var(--primary-light);}
@keyframes slideIn{from{opacity:0;transform:translateX(30px);}to{opacity:1;transform:translateX(0);}}
/* ‚îÄ‚îÄ LANDING ‚îÄ‚îÄ */
#landing{display:flex;flex-direction:column;min-height:100vh;}
.land-nav{position:fixed;top:0;left:0;right:0;z-index:100;padding:16px 48px;display:flex;align-items:center;justify-content:space-between;background:rgba(6,11,24,.8);backdrop-filter:blur(20px);border-bottom:1px solid var(--border2);}
.nav-logo{display:flex;align-items:center;gap:10px;font-size:20px;font-weight:800;letter-spacing:-.5px;}
.nav-links{display:flex;gap:32px;}
.nav-links a{color:var(--text2);text-decoration:none;font-size:14px;font-weight:500;cursor:pointer;transition:.2s;}
.nav-links a:hover{color:var(--text);}
.nav-actions{display:flex;gap:12px;}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 20px;border-radius:var(--r3);border:none;cursor:pointer;font-family:'Inter',sans-serif;font-weight:600;font-size:14px;transition:all .2s;}
.btn-ghost{background:transparent;color:var(--text2);border:1px solid var(--border2);}
.btn-ghost:hover{background:rgba(255,255,255,.05);color:var(--text);}
.btn-primary{background:var(--grad);color:#fff;box-shadow:var(--shadow);}
.btn-primary:hover{opacity:.9;transform:translateY(-1px);}
.btn-secondary{background:rgba(124,58,237,.12);color:var(--primary-light);border:1px solid var(--border);}
.btn-secondary:hover{background:rgba(124,58,237,.2);}
.btn-sm{padding:8px 16px;font-size:13px;}
.btn-lg{padding:14px 28px;font-size:15px;border-radius:var(--r2);}
.btn-red{background:rgba(239,68,68,.12);color:#FCA5A5;border:1px solid rgba(239,68,68,.3);}
.btn-green{background:rgba(16,185,129,.12);color:#6EE7B7;border:1px solid rgba(16,185,129,.3);}
.land-hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:120px 24px 80px;position:relative;overflow:hidden;}
.hero-bg{position:absolute;inset:0;background:radial-gradient(ellipse 80% 60% at 50% 0%,rgba(124,58,237,.15),transparent);pointer-events:none;}
.hero-badge{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;border-radius:50px;background:rgba(124,58,237,.12);border:1px solid var(--border);font-size:13px;color:var(--primary-light);font-weight:500;margin-bottom:24px;}
.hero-title{font-size:clamp(40px,7vw,80px);font-weight:900;line-height:1.08;letter-spacing:-2px;margin-bottom:24px;}
.hero-title .grad-text{background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.hero-sub{font-size:18px;color:var(--text2);max-width:560px;line-height:1.7;margin-bottom:40px;}
.hero-actions{display:flex;gap:16px;flex-wrap:wrap;justify-content:center;}
.hero-stats{display:flex;gap:48px;margin-top:60px;padding-top:60px;border-top:1px solid var(--border2);}
.hero-stat{text-align:center;}
.hero-stat h3{font-size:32px;font-weight:800;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.hero-stat p{font-size:13px;color:var(--text3);margin-top:4px;}
.land-section{padding:100px 48px;max-width:1200px;margin:0 auto;}
.section-label{font-size:12px;font-weight:700;letter-spacing:2px;color:var(--primary-light);text-transform:uppercase;margin-bottom:12px;}
.section-title{font-size:clamp(28px,4vw,44px);font-weight:800;letter-spacing:-1px;line-height:1.2;margin-bottom:16px;}
.section-sub{font-size:16px;color:var(--text2);line-height:1.7;max-width:560px;margin-bottom:56px;}
.features-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:24px;}
.feat-card{background:var(--card);border:1px solid var(--border2);border-radius:var(--r);padding:28px;transition:.3s;}
.feat-card:hover{border-color:var(--border);transform:translateY(-4px);box-shadow:var(--shadow);}
.feat-icon{width:48px;height:48px;border-radius:var(--r3);background:rgba(124,58,237,.15);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;margin-bottom:20px;font-size:22px;}
.feat-card h3{font-size:17px;font-weight:700;margin-bottom:10px;}
.feat-card p{font-size:14px;color:var(--text2);line-height:1.65;}
.pricing-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;max-width:760px;margin:0 auto;}
.price-card{background:var(--card);border:1px solid var(--border2);border-radius:var(--r);padding:36px;position:relative;transition:.3s;}
.price-card.featured{border-color:var(--primary);box-shadow:0 0 40px rgba(124,58,237,.2);}
.price-badge{position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:var(--grad);color:#fff;font-size:11px;font-weight:700;padding:4px 14px;border-radius:50px;letter-spacing:1px;text-transform:uppercase;white-space:nowrap;}
.price-name{font-size:14px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;}
.price-amount{font-size:40px;font-weight:900;letter-spacing:-1px;margin-bottom:4px;}
.price-amount span{font-size:16px;font-weight:400;color:var(--text2);}
.price-desc{font-size:13px;color:var(--text3);margin-bottom:28px;}
.price-features{list-style:none;display:flex;flex-direction:column;gap:12px;margin-bottom:32px;}
.price-features li{font-size:14px;color:var(--text2);display:flex;align-items:center;gap:10px;}
.price-features li::before{content:'‚úì';color:var(--green);font-weight:700;flex-shrink:0;}
.price-features li.no::before{content:'√ó';color:var(--text3);}
.price-features li.no{color:var(--text3);}
.land-footer{border-top:1px solid var(--border2);padding:40px 48px;display:flex;align-items:center;justify-content:space-between;background:var(--bg2);}
.footer-links{display:flex;gap:24px;}
.footer-links a{color:var(--text3);font-size:13px;text-decoration:none;cursor:pointer;}
.footer-links a:hover{color:var(--text2);}
/* ‚îÄ‚îÄ AUTH MODAL ‚îÄ‚îÄ */
#authModal{position:fixed;inset:0;z-index:1000;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.7);backdrop-filter:blur(12px);}
.auth-box{background:var(--bg2);border:1px solid var(--border2);border-radius:var(--r);padding:40px;width:100%;max-width:420px;position:relative;}
.auth-close{position:absolute;top:16px;right:16px;background:transparent;border:none;color:var(--text3);font-size:20px;cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:8px;}
.auth-close:hover{background:rgba(255,255,255,.06);color:var(--text);}
.auth-logo{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:28px;}
.auth-title{font-size:24px;font-weight:800;text-align:center;margin-bottom:6px;letter-spacing:-.5px;}
.auth-sub{font-size:14px;color:var(--text2);text-align:center;margin-bottom:28px;}
.auth-tabs{display:flex;background:rgba(255,255,255,.04);border-radius:var(--r3);padding:4px;margin-bottom:24px;}
.auth-tab{flex:1;padding:8px;border-radius:6px;border:none;background:transparent;color:var(--text2);font-family:'Inter',sans-serif;font-size:14px;font-weight:500;cursor:pointer;transition:.2s;}
.auth-tab.active{background:var(--primary);color:#fff;box-shadow:var(--shadow);}
.form-group{margin-bottom:16px;}
.form-label{font-size:13px;font-weight:500;color:var(--text2);margin-bottom:8px;display:block;}
.form-input{width:100%;padding:12px 16px;background:rgba(255,255,255,.04);border:1px solid var(--border2);border-radius:var(--r3);color:var(--text);font-family:'Inter',sans-serif;font-size:14px;outline:none;transition:.2s;}
.form-input:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(124,58,237,.15);}
.form-input::placeholder{color:var(--text3);}
.auth-or{display:flex;align-items:center;gap:12px;margin:20px 0;color:var(--text3);font-size:13px;}
.auth-or::before,.auth-or::after{content:'';flex:1;height:1px;background:var(--border2);}
.btn-google{width:100%;background:rgba(255,255,255,.05);border:1px solid var(--border2);color:var(--text);display:flex;align-items:center;justify-content:center;gap:12px;padding:12px;border-radius:var(--r3);cursor:pointer;font-family:'Inter',sans-serif;font-size:14px;font-weight:500;transition:.2s;}
.btn-google:hover{background:rgba(255,255,255,.08);}
.btn-full{width:100%;margin-top:4px;}
/* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
#dashboard{display:flex;min-height:100vh;}
.sidebar{width:260px;min-height:100vh;background:var(--bg2);border-right:1px solid var(--border2);display:flex;flex-direction:column;position:fixed;top:0;left:0;z-index:50;}
.sidebar-logo{padding:24px 20px;border-bottom:1px solid var(--border2);display:flex;align-items:center;gap:10px;font-size:18px;font-weight:800;letter-spacing:-.3px;}
.sidebar-user{padding:16px 20px;border-bottom:1px solid var(--border2);}
.sidebar-user-info{display:flex;align-items:center;gap:12px;}
.sidebar-avatar{width:40px;height:40px;border-radius:50%;background:var(--grad);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:16px;flex-shrink:0;overflow:hidden;}
.sidebar-avatar img{width:100%;height:100%;object-fit:cover;}
.sidebar-name{font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.sidebar-email{font-size:11px;color:var(--text3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.sidebar-plan{display:inline-flex;align-items:center;gap:4px;margin-top:6px;padding:3px 8px;border-radius:50px;font-size:10px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;}
.plan-free{background:rgba(100,116,139,.15);color:var(--text3);}
.plan-premium{background:linear-gradient(135deg,rgba(124,58,237,.2),rgba(6,182,212,.2));color:var(--cyan);border:1px solid rgba(6,182,212,.3);}
.sidebar-nav{flex:1;padding:12px 0;overflow-y:auto;}
.nav-item{display:flex;align-items:center;gap:12px;padding:11px 20px;color:var(--text2);cursor:pointer;transition:.2s;font-size:14px;font-weight:500;border-left:3px solid transparent;position:relative;}
.nav-item:hover{color:var(--text);background:rgba(255,255,255,.03);}
.nav-item.active{color:#fff;background:rgba(124,58,237,.12);border-left-color:var(--primary);}
.nav-item .nav-icon{font-size:18px;width:24px;text-align:center;flex-shrink:0;}
.notif-badge{background:var(--primary);color:#fff;font-size:10px;font-weight:700;padding:2px 6px;border-radius:50px;margin-left:auto;}
.sidebar-bottom{padding:16px 20px;border-top:1px solid var(--border2);display:flex;flex-direction:column;gap:8px;}
.dash-main{margin-left:260px;flex:1;display:flex;flex-direction:column;min-height:100vh;}
.dash-topbar{position:sticky;top:0;z-index:40;padding:0 32px;height:64px;background:rgba(6,11,24,.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border2);display:flex;align-items:center;justify-content:space-between;}
.topbar-title{font-size:18px;font-weight:700;}
.topbar-actions{display:flex;align-items:center;gap:12px;}
.notif-bell{position:relative;width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:var(--r3);background:rgba(255,255,255,.04);border:1px solid var(--border2);cursor:pointer;font-size:16px;}
.notif-bell .dot{position:absolute;top:6px;right:6px;width:8px;height:8px;background:var(--primary);border-radius:50%;border:2px solid var(--bg);}
.dash-content{flex:1;padding:32px;}
/* Panels */
.panel{display:none;}
.panel.active{display:block;}
/* Cards */
.card{background:var(--card);border:1px solid var(--border2);border-radius:var(--r);padding:24px;}
.card-title{font-size:16px;font-weight:700;margin-bottom:4px;}
.card-sub{font-size:13px;color:var(--text2);}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:28px;}
.stat-card{background:var(--card);border:1px solid var(--border2);border-radius:var(--r);padding:20px;position:relative;overflow:hidden;}
.stat-card::before{content:'';position:absolute;top:-20px;right:-20px;width:80px;height:80px;border-radius:50%;background:rgba(124,58,237,.08);}
.stat-value{font-size:28px;font-weight:800;margin-bottom:4px;}
.stat-label{font-size:13px;color:var(--text2);}
.stat-icon{font-size:28px;margin-bottom:12px;}
.upgrade-banner{background:linear-gradient(135deg,rgba(124,58,237,.15),rgba(6,182,212,.1));border:1px solid var(--border);border-radius:var(--r);padding:24px;display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:28px;}
.upgrade-banner h3{font-size:16px;font-weight:700;margin-bottom:6px;}
.upgrade-banner p{font-size:13px;color:var(--text2);max-width:420px;}
/* QR Panel */
.qr-layout{display:grid;grid-template-columns:1fr 360px;gap:24px;align-items:start;}
.qr-form-group{margin-bottom:20px;}
.qr-form-group label{display:block;font-size:13px;font-weight:600;color:var(--text2);margin-bottom:8px;}
.qr-type-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:20px;}
.qr-type-btn{background:rgba(255,255,255,.04);border:1px solid var(--border2);border-radius:var(--r3);padding:10px 6px;cursor:pointer;text-align:center;font-size:11px;font-weight:600;color:var(--text2);transition:.2s;}
.qr-type-btn.active{border-color:var(--primary);background:rgba(124,58,237,.12);color:var(--primary-light);}
.qr-type-btn .qti{font-size:20px;display:block;margin-bottom:4px;}
.qr-preview-card{position:sticky;top:80px;}
.qr-canvas-wrap{background:#fff;border-radius:var(--r2);padding:20px;display:flex;justify-content:center;margin-bottom:16px;position:relative;}
#qrCanvas{display:block;max-width:100%;border-radius:4px;}
.premium-lock{position:absolute;inset:0;background:rgba(6,11,24,.8);border-radius:var(--r2);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px;backdrop-filter:blur(4px);}
.premium-lock span{font-size:32px;}
.premium-lock p{font-size:12px;color:var(--text2);text-align:center;}
.color-row{display:flex;gap:12px;flex-wrap:wrap;}
.color-item{flex:1;}
.color-item label{display:block;font-size:11px;font-weight:600;color:var(--text3);margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px;}
input[type=color]{width:100%;height:36px;border-radius:var(--r3);border:1px solid var(--border2);background:transparent;cursor:pointer;padding:2px;}
.shape-grid{display:flex;gap:8px;}
.shape-btn{flex:1;background:rgba(255,255,255,.04);border:1px solid var(--border2);border-radius:var(--r3);padding:8px;cursor:pointer;text-align:center;font-size:11px;font-weight:600;color:var(--text2);transition:.2s;}
.shape-btn.active{border-color:var(--primary);color:var(--primary-light);background:rgba(124,58,237,.1);}
.error-select{width:100%;padding:10px 12px;background:rgba(255,255,255,.04);border:1px solid var(--border2);border-radius:var(--r3);color:var(--text);font-family:'Inter',sans-serif;font-size:13px;outline:none;cursor:pointer;}
.frame-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
.frame-btn{background:rgba(255,255,255,.04);border:1px solid var(--border2);border-radius:var(--r3);padding:8px;cursor:pointer;text-align:center;font-size:18px;transition:.2s;}
.frame-btn.active{border-color:var(--primary);background:rgba(124,58,237,.1);}
.section-divider{height:1px;background:var(--border2);margin:20px 0;}
.premium-feature{position:relative;}
.premium-feature.locked::after{content:'‚≠ê PREMIUM';position:absolute;top:-1px;right:0;background:linear-gradient(135deg,#7C3AED,#06B6D4);color:#fff;font-size:9px;font-weight:700;padding:3px 8px;border-radius:50px;letter-spacing:.5px;}
/* Links Panel */
.links-layout{display:grid;grid-template-columns:1fr 1fr;gap:24px;align-items:start;}
.link-item{background:var(--bg3);border:1px solid var(--border2);border-radius:var(--r3);padding:16px;margin-bottom:12px;transition:.2s;}
.link-item:hover{border-color:var(--border);}
.link-item h4{font-size:14px;font-weight:600;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.link-item .short{font-size:13px;color:var(--primary-light);margin-bottom:8px;display:flex;align-items:center;gap:6px;}
.link-meta{font-size:11px;color:var(--text3);display:flex;gap:16px;}
.link-actions{display:flex;gap:6px;margin-top:10px;}
/* Analytics */
.analytics-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:28px;}
.chart-bar-wrap{display:flex;flex-direction:column;gap:6px;margin-top:16px;}
.chart-bar-item{display:flex;align-items:center;gap:10px;font-size:13px;}
.chart-bar-item .bar-label{width:80px;color:var(--text2);text-align:right;font-size:12px;}
.chart-bar-track{flex:1;height:8px;background:rgba(255,255,255,.06);border-radius:4px;overflow:hidden;}
.chart-bar-fill{height:100%;border-radius:4px;background:var(--grad);transition:width 1s ease;}
.chart-bar-val{width:40px;text-align:right;font-size:12px;color:var(--text2);}
/* Notifications */
.notif-item{background:var(--bg3);border:1px solid var(--border2);border-radius:var(--r3);padding:16px;margin-bottom:10px;transition:.2s;display:flex;gap:14px;align-items:flex-start;}
.notif-item.unread{border-color:rgba(124,58,237,.3);background:rgba(124,58,237,.06);}
.notif-dot{width:8px;height:8px;border-radius:50%;background:var(--primary);flex-shrink:0;margin-top:6px;}
.notif-dot.read{background:var(--text3);}
.notif-item h4{font-size:14px;font-weight:600;margin-bottom:4px;}
.notif-item p{font-size:13px;color:var(--text2);line-height:1.5;}
.notif-time{font-size:11px;color:var(--text3);margin-top:6px;}
/* AI Chat */
.chat-layout{display:flex;flex-direction:column;height:calc(100vh - 160px);}
.chat-messages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;background:var(--bg3);border:1px solid var(--border2);border-radius:var(--r) var(--r) 0 0;}
.chat-msg{display:flex;gap:10px;max-width:75%;}
.chat-msg.user{align-self:flex-end;flex-direction:row-reverse;}
.chat-bubble{padding:12px 16px;border-radius:16px;font-size:14px;line-height:1.6;}
.chat-msg.bot .chat-bubble{background:rgba(124,58,237,.12);border:1px solid var(--border);border-bottom-left-radius:4px;}
.chat-msg.user .chat-bubble{background:var(--grad);color:#fff;border-bottom-right-radius:4px;}
.chat-avatar{width:32px;height:32px;border-radius:50%;background:var(--grad);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;}
.chat-input-bar{display:flex;gap:8px;padding:12px;background:var(--card);border:1px solid var(--border2);border-top:none;border-radius:0 0 var(--r) var(--r);}
.chat-input{flex:1;background:rgba(255,255,255,.04);border:1px solid var(--border2);border-radius:var(--r3);padding:10px 16px;color:var(--text);font-family:'Inter',sans-serif;font-size:14px;outline:none;resize:none;}
.chat-send{background:var(--grad);border:none;border-radius:var(--r3);width:40px;height:40px;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#fff;font-size:18px;flex-shrink:0;}
.typing-indicator{display:flex;gap:4px;align-items:center;padding:12px 16px;}
.typing-dot{width:6px;height:6px;border-radius:50%;background:var(--text3);animation:typingBounce 1.4s ease infinite;}
.typing-dot:nth-child(2){animation-delay:.2s;}
.typing-dot:nth-child(3){animation-delay:.4s;}
@keyframes typingBounce{0%,60%,100%{transform:translateY(0);}30%{transform:translateY(-8px);}}
/* Settings */
.settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;}
/* Upgrade */
.upgrade-panel{max-width:600px;margin:0 auto;text-align:center;}
/* ‚îÄ‚îÄ ADMIN DASHBOARD ‚îÄ‚îÄ */
#admin{display:flex;min-height:100vh;}
.admin-sidebar{width:240px;min-height:100vh;background:var(--bg2);border-right:1px solid var(--border2);display:flex;flex-direction:column;position:fixed;top:0;left:0;}
.admin-main{margin-left:240px;flex:1;min-height:100vh;}
.admin-topbar{padding:0 28px;height:60px;background:rgba(6,11,24,.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--border2);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:40;}
.admin-topbar h2{font-size:16px;font-weight:700;}
.admin-content{padding:28px;}
.admin-panel{display:none;}
.admin-panel.active{display:block;}
.table-wrap{overflow-x:auto;border-radius:var(--r3);border:1px solid var(--border2);}
table{width:100%;border-collapse:collapse;}
thead{background:rgba(255,255,255,.03);}
th{padding:12px 16px;text-align:left;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--text3);border-bottom:1px solid var(--border2);}
td{padding:12px 16px;font-size:13px;border-bottom:1px solid rgba(255,255,255,.03);}
tr:last-child td{border-bottom:none;}
tr:hover td{background:rgba(255,255,255,.02);}
.badge{display:inline-flex;padding:3px 10px;border-radius:50px;font-size:11px;font-weight:600;}
.badge-premium{background:rgba(6,182,212,.12);color:var(--cyan);border:1px solid rgba(6,182,212,.3);}
.badge-free{background:rgba(100,116,139,.1);color:var(--text3);}
.badge-admin{background:rgba(245,158,11,.12);color:var(--yellow);border:1px solid rgba(245,158,11,.3);}
.badge-open{background:rgba(239,68,68,.12);color:#FCA5A5;}
.badge-resolved{background:rgba(16,185,129,.12);color:#6EE7B7;}
.admin-stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px;}
.notif-form{display:grid;gap:16px;}
.ceo-welcome{background:linear-gradient(135deg,rgba(245,158,11,.1),rgba(124,58,237,.15));border:1px solid rgba(245,158,11,.2);border-radius:var(--r);padding:20px;margin-bottom:24px;display:flex;align-items:center;gap:16px;}
.ceo-avatar{width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,#F59E0B,#EF4444);display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:900;}
.ceo-info h3{font-size:18px;font-weight:800;}
.ceo-info p{font-size:13px;color:var(--text2);}
/* AI mini-loader */
.ai-loading{display:flex;align-items:center;gap:8px;padding:8px 0;color:var(--text3);font-size:13px;}
.ai-loading::before{content:'';width:16px;height:16px;border:2px solid var(--border2);border-top-color:var(--primary);border-radius:50%;animation:spin .8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
.fade-in{animation:fadeIn .4s ease;}
/* QR frame canvas wrapper */
.qr-frame-1{border:3px solid #7C3AED;border-radius:12px;padding:12px;}
.qr-frame-2{border:3px dashed #06B6D4;border-radius:4px;padding:12px;}
.qr-frame-3{border:6px solid #F59E0B;border-radius:50%;padding:16px;}
.qr-frame-4{border:3px solid var(--text);padding:12px;box-shadow:4px 4px 0 #7C3AED;}
/* Empty state */
.empty{text-align:center;padding:60px 20px;color:var(--text3);}
.empty .empty-icon{font-size:48px;margin-bottom:16px;}
.empty p{font-size:14px;}
/* Scrollable chat */
.chat-messages::-webkit-scrollbar{width:3px;}
select.form-input{cursor:pointer;}
textarea.form-input{resize:vertical;min-height:80px;}
</style>
</head>
<body>

<!-- GLOBAL LOADER -->
<div id="globalLoader">
  <div class="loader-logo">
    <svg width="72" height="72" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
      <defs><linearGradient id="lg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C3AED"/><stop offset="100%" stop-color="#06B6D4"/></linearGradient></defs>
      <rect width="72" height="72" rx="18" fill="url(#lg)"/>
      <rect x="8" y="8" width="20" height="20" rx="4" fill="white" opacity=".95"/>
      <rect x="12" y="12" width="12" height="12" fill="url(#lg)"/>
      <rect x="15" y="15" width="6" height="6" fill="white"/>
      <rect x="44" y="8" width="20" height="20" rx="4" fill="white" opacity=".95"/>
      <rect x="48" y="12" width="12" height="12" fill="url(#lg)"/>
      <rect x="51" y="15" width="6" height="6" fill="white"/>
      <rect x="8" y="44" width="20" height="20" rx="4" fill="white" opacity=".95"/>
      <rect x="12" y="48" width="12" height="12" fill="url(#lg)"/>
      <rect x="15" y="51" width="6" height="6" fill="white"/>
      <rect x="36" y="8" width="4" height="4" rx="1" fill="white" opacity=".5"/>
      <rect x="42" y="8" width="4" height="4" rx="1" fill="white" opacity=".3"/>
      <rect x="8" y="36" width="4" height="4" rx="1" fill="white" opacity=".5"/>
      <rect x="8" y="42" width="4" height="4" rx="1" fill="white" opacity=".3"/>
      <rect x="36" y="36" width="4" height="4" rx="1" fill="white" opacity=".7"/>
      <rect x="42" y="36" width="4" height="4" rx="1" fill="white" opacity=".5"/>
      <rect x="48" y="36" width="4" height="4" rx="1" fill="white" opacity=".3"/>
      <rect x="36" y="42" width="4" height="4" rx="1" fill="white" opacity=".5"/>
      <rect x="42" y="42" width="4" height="4" rx="1" fill="white" opacity=".7"/>
      <rect x="48" y="42" width="4" height="4" rx="1" fill="white" opacity=".4"/>
      <rect x="36" y="48" width="4" height="4" rx="1" fill="white" opacity=".4"/>
      <rect x="48" y="48" width="4" height="4" rx="1" fill="white" opacity=".6"/>
      <rect x="42" y="54" width="4" height="4" rx="1" fill="white" opacity=".3"/>
      <rect x="54" y="36" width="4" height="4" rx="1" fill="white" opacity=".3"/>
      <rect x="60" y="42" width="4" height="4" rx="1" fill="white" opacity=".2"/>
    </svg>
  </div>
  <div class="loader-dots">
    <div class="loader-dot"></div>
    <div class="loader-dot"></div>
    <div class="loader-dot"></div>
  </div>
  <p style="color:var(--text2);font-size:13px;font-weight:500;">Loading Trisend‚Ä¶</p>
</div>

<!-- TOAST CONTAINER -->
<div id="toastContainer"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LANDING PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="landing" class="hidden">
  <nav class="land-nav">
    <div class="nav-logo">
      <svg width="32" height="32" viewBox="0 0 72 72" fill="none"><defs><linearGradient id="nlg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C3AED"/><stop offset="100%" stop-color="#06B6D4"/></linearGradient></defs><rect width="72" height="72" rx="18" fill="url(#nlg)"/><rect x="8" y="8" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="12" y="12" width="12" height="12" fill="url(#nlg)"/><rect x="15" y="15" width="6" height="6" fill="white"/><rect x="44" y="8" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="48" y="12" width="12" height="12" fill="url(#nlg)"/><rect x="51" y="15" width="6" height="6" fill="white"/><rect x="8" y="44" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="12" y="48" width="12" height="12" fill="url(#nlg)"/><rect x="15" y="51" width="6" height="6" fill="white"/><rect x="36" y="36" width="4" height="4" rx="1" fill="white" opacity=".7"/><rect x="42" y="42" width="4" height="4" rx="1" fill="white" opacity=".7"/><rect x="48" y="36" width="4" height="4" rx="1" fill="white" opacity=".4"/></svg>
      Trisend
    </div>
    <div class="nav-links">
      <a onclick="scrollTo('#features')">Features</a>
      <a onclick="scrollTo('#pricing')">Pricing</a>
      <a onclick="scrollTo('#how')">How it works</a>
      <a onclick="showSupport()">Support</a>
    </div>
    <div class="nav-actions">
      <button class="btn btn-ghost" onclick="showAuth('login')">Log In</button>
      <button class="btn btn-primary" onclick="showAuth('signup')">Get Started Free</button>
    </div>
  </nav>

  <!-- Hero -->
  <section class="land-hero" id="hero">
    <div class="hero-bg"></div>
    <div class="hero-badge">‚ú® The smartest QR & link platform in Africa</div>
    <h1 class="hero-title">Generate. Share.<br><span class="grad-text">Track Everything.</span></h1>
    <p class="hero-sub">Create beautiful QR codes and short links in seconds. Track every scan and click with powerful analytics. Premium features for teams and creators.</p>
    <div class="hero-actions">
      <button class="btn btn-primary btn-lg" onclick="showAuth('signup')">üöÄ Start for Free</button>
      <button class="btn btn-ghost btn-lg" onclick="scrollTo('#features')">See Features ‚Üí</button>
    </div>
    <div class="hero-stats">
      <div class="hero-stat"><h3>50K+</h3><p>QR Codes Created</p></div>
      <div class="hero-stat"><h3>120K+</h3><p>Links Shortened</p></div>
      <div class="hero-stat"><h3>2M+</h3><p>Total Scans</p></div>
      <div class="hero-stat"><h3>99.9%</h3><p>Uptime</p></div>
    </div>
  </section>

  <!-- Features -->
  <section class="land-section" id="features">
    <div class="section-label">Features</div>
    <h2 class="section-title">Everything you need to grow</h2>
    <p class="section-sub">From basic QR codes to advanced analytics ‚Äî Trisend has you covered.</p>
    <div class="features-grid">
      <div class="feat-card"><div class="feat-icon">‚ö°</div><h3>Instant QR Codes</h3><p>Generate QR codes for URLs, text, WiFi, contacts, and more in seconds. Download in HD quality.</p></div>
      <div class="feat-card"><div class="feat-icon">üîó</div><h3>Smart Link Shortener</h3><p>Create short, memorable links that redirect instantly. Track clicks and share anywhere.</p></div>
      <div class="feat-card"><div class="feat-icon">üìä</div><h3>Real-Time Analytics</h3><p>Know exactly how your QR codes and links are performing with detailed scan and click data.</p></div>
      <div class="feat-card"><div class="feat-icon">üé®</div><h3>Custom Branding</h3><p>Add your logo, choose custom colors, frames, and shapes. Make every QR code yours. (Premium)</p></div>
      <div class="feat-card"><div class="feat-icon">üîî</div><h3>Smart Notifications</h3><p>Stay updated with platform announcements, tips, and upgrade reminders from our team.</p></div>
      <div class="feat-card"><div class="feat-icon">ü§ñ</div><h3>AI Assistant</h3><p>Get instant answers about the platform, troubleshoot issues, and get smart recommendations.</p></div>
    </div>
  </section>

  <!-- How it works -->
  <section class="land-section" id="how" style="text-align:center;">
    <div class="section-label">How It Works</div>
    <h2 class="section-title">Three steps to get started</h2>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:32px;margin-top:40px;">
      <div><div style="font-size:48px;margin-bottom:16px;">üë§</div><h3 style="font-size:17px;font-weight:700;margin-bottom:8px;">1. Create Account</h3><p style="color:var(--text2);font-size:14px;">Sign up free in seconds ‚Äî no credit card required.</p></div>
      <div><div style="font-size:48px;margin-bottom:16px;">‚ö°</div><h3 style="font-size:17px;font-weight:700;margin-bottom:8px;">2. Generate</h3><p style="color:var(--text2);font-size:14px;">Create QR codes or shorten any link instantly.</p></div>
      <div><div style="font-size:48px;margin-bottom:16px;">üìà</div><h3 style="font-size:17px;font-weight:700;margin-bottom:8px;">3. Track & Share</h3><p style="color:var(--text2);font-size:14px;">Share anywhere and watch your analytics grow in real time.</p></div>
    </div>
  </section>

  <!-- Pricing -->
  <section class="land-section" id="pricing" style="text-align:center;">
    <div class="section-label">Pricing</div>
    <h2 class="section-title">Simple, honest pricing</h2>
    <p class="section-sub" style="margin:0 auto 40px;">Pay once. Use forever. No subscriptions.</p>
    <div class="pricing-grid">
      <div class="price-card">
        <div class="price-name">Free</div>
        <div class="price-amount">‚Ç¶0 <span>/ always</span></div>
        <p class="price-desc">Perfect for getting started</p>
        <ul class="price-features">
          <li>Up to 10 QR codes</li>
          <li>Up to 20 short links</li>
          <li>Basic analytics</li>
          <li>Standard QR styles</li>
          <li class="no">Custom colors & shapes</li>
          <li class="no">Logo in QR code</li>
          <li class="no">QR frames</li>
          <li class="no">Custom link aliases</li>
        </ul>
        <button class="btn btn-secondary btn-full" onclick="showAuth('signup')">Get Started Free</button>
      </div>
      <div class="price-card featured">
        <div class="price-badge">‚≠ê RECOMMENDED</div>
        <div class="price-name">Premium</div>
        <div class="price-amount">‚Ç¶2,000 <span>/ one-time</span></div>
        <p class="price-desc">Lifetime access. Pay once, own forever.</p>
        <ul class="price-features">
          <li>Unlimited QR codes</li>
          <li>Unlimited short links</li>
          <li>Advanced analytics</li>
          <li>Custom colors & shapes</li>
          <li>Logo in QR code</li>
          <li>Beautiful QR frames</li>
          <li>Custom link aliases</li>
          <li>Priority support</li>
        </ul>
        <button class="btn btn-primary btn-full" onclick="showAuth('signup')">Upgrade for ‚Ç¶2,000</button>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="land-footer">
    <div class="nav-logo" style="font-size:16px;">
      <svg width="24" height="24" viewBox="0 0 72 72" fill="none"><defs><linearGradient id="flg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C3AED"/><stop offset="100%" stop-color="#06B6D4"/></linearGradient></defs><rect width="72" height="72" rx="18" fill="url(#flg)"/><rect x="8" y="8" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="12" y="12" width="12" height="12" fill="url(#flg)"/><rect x="15" y="15" width="6" height="6" fill="white"/><rect x="44" y="8" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="48" y="12" width="12" height="12" fill="url(#flg)"/><rect x="51" y="15" width="6" height="6" fill="white"/><rect x="8" y="44" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="12" y="48" width="12" height="12" fill="url(#flg)"/><rect x="15" y="51" width="6" height="6" fill="white"/></svg>
      Trisend
    </div>
    <p style="font-size:13px;color:var(--text3);">¬© 2025 Trisend. All rights reserved.</p>
    <div class="footer-links">
      <a onclick="showSupport()">Support</a>
      <a href="mailto:trisendmailer@gmail.com">Contact</a>
      <a onclick="showAuth('login')">Login</a>
    </div>
  </footer>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="authModal" class="hidden">
  <div class="auth-box fade-in">
    <button class="auth-close" onclick="hideAuth()">‚úï</button>
    <div class="auth-logo">
      <svg width="36" height="36" viewBox="0 0 72 72" fill="none"><defs><linearGradient id="alg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C3AED"/><stop offset="100%" stop-color="#06B6D4"/></linearGradient></defs><rect width="72" height="72" rx="18" fill="url(#alg)"/><rect x="8" y="8" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="12" y="12" width="12" height="12" fill="url(#alg)"/><rect x="15" y="15" width="6" height="6" fill="white"/><rect x="44" y="8" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="48" y="12" width="12" height="12" fill="url(#alg)"/><rect x="51" y="15" width="6" height="6" fill="white"/><rect x="8" y="44" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="12" y="48" width="12" height="12" fill="url(#alg)"/><rect x="15" y="51" width="6" height="6" fill="white"/></svg>
      <span style="font-size:20px;font-weight:800;">Trisend</span>
    </div>
    <div class="auth-tabs">
      <button class="auth-tab active" id="tabLogin" onclick="switchAuthTab('login')">Log In</button>
      <button class="auth-tab" id="tabSignup" onclick="switchAuthTab('signup')">Sign Up</button>
    </div>
    <!-- Login -->
    <div id="loginForm">
      <div class="auth-title">Welcome back</div>
      <div class="auth-sub">Sign in to your Trisend account</div>
      <div class="form-group"><label class="form-label">Email</label><input id="loginEmail" type="email" class="form-input" placeholder="you@example.com"></div>
      <div class="form-group"><label class="form-label">Password</label><input id="loginPass" type="password" class="form-input" placeholder="Your password"></div>
      <button class="btn btn-primary btn-full" onclick="doLogin()" style="margin-top:8px;">Log In</button>
      <div class="auth-or">or</div>
      <button class="btn-google" onclick="doGoogleAuth()">
        <svg width="18" height="18" viewBox="0 0 18 18"><path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/><path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z"/><path fill="#FBBC05" d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"/><path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/></svg>
        Continue with Google
      </button>
    </div>
    <!-- Signup -->
    <div id="signupForm" class="hidden">
      <div class="auth-title">Create account</div>
      <div class="auth-sub">Join thousands of creators on Trisend</div>
      <div class="form-group"><label class="form-label">Full Name</label><input id="signupName" type="text" class="form-input" placeholder="Your full name"></div>
      <div class="form-group"><label class="form-label">Email</label><input id="signupEmail" type="email" class="form-input" placeholder="you@example.com"></div>
      <div class="form-group"><label class="form-label">Password</label><input id="signupPass" type="password" class="form-input" placeholder="Min 8 characters"></div>
      <button class="btn btn-primary btn-full" onclick="doSignup()" style="margin-top:8px;">Create Account</button>
      <div class="auth-or">or</div>
      <button class="btn-google" onclick="doGoogleAuth()">
        <svg width="18" height="18" viewBox="0 0 18 18"><path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/><path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z"/><path fill="#FBBC05" d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"/><path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z"/></svg>
        Sign Up with Google
      </button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê USER DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="dashboard" class="hidden">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-logo">
      <svg width="28" height="28" viewBox="0 0 72 72" fill="none"><defs><linearGradient id="slg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C3AED"/><stop offset="100%" stop-color="#06B6D4"/></linearGradient></defs><rect width="72" height="72" rx="18" fill="url(#slg)"/><rect x="8" y="8" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="12" y="12" width="12" height="12" fill="url(#slg)"/><rect x="15" y="15" width="6" height="6" fill="white"/><rect x="44" y="8" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="48" y="12" width="12" height="12" fill="url(#slg)"/><rect x="51" y="15" width="6" height="6" fill="white"/><rect x="8" y="44" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="12" y="48" width="12" height="12" fill="url(#slg)"/><rect x="15" y="51" width="6" height="6" fill="white"/></svg>
      Trisend
    </div>
    <div class="sidebar-user">
      <div class="sidebar-user-info">
        <div class="sidebar-avatar" id="sidebarAvatar">T</div>
        <div style="min-width:0;">
          <div class="sidebar-name" id="sidebarName">Loading‚Ä¶</div>
          <div class="sidebar-email" id="sidebarEmail"></div>
          <div class="sidebar-plan plan-free" id="sidebarPlan">Free</div>
        </div>
      </div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-item active" data-panel="home" onclick="showPanel('home')"><span class="nav-icon">üè†</span>Dashboard</div>
      <div class="nav-item" data-panel="qr" onclick="showPanel('qr')"><span class="nav-icon">‚¨ú</span>QR Generator</div>
      <div class="nav-item" data-panel="links" onclick="showPanel('links')"><span class="nav-icon">üîó</span>Short Links</div>
      <div class="nav-item" data-panel="analytics" onclick="showPanel('analytics')"><span class="nav-icon">üìä</span>Analytics</div>
      <div class="nav-item" data-panel="notifications" onclick="showPanel('notifications')"><span class="nav-icon">üîî</span>Notifications<span class="notif-badge hidden" id="notifBadge">0</span></div>
      <div class="nav-item" data-panel="chat" onclick="showPanel('chat')"><span class="nav-icon">ü§ñ</span>AI Assistant</div>
      <div class="nav-item" data-panel="settings" onclick="showPanel('settings')"><span class="nav-icon">‚öôÔ∏è</span>Settings</div>
    </nav>
    <div class="sidebar-bottom">
      <div class="nav-item" data-panel="upgrade" onclick="showPanel('upgrade')" style="background:linear-gradient(135deg,rgba(124,58,237,.15),rgba(6,182,212,.1));border-radius:var(--r3);border:1px solid var(--border);" id="upgradeNavItem"><span class="nav-icon">‚≠ê</span>Upgrade to Premium</div>
      <div class="nav-item" onclick="doLogout()" style="color:var(--red);" id="adminNav" class="hidden"><span class="nav-icon">üõ°Ô∏è</span>Admin Panel</div>
      <div class="nav-item" onclick="doLogout()" style="color:#EF4444;"><span class="nav-icon">üö™</span>Log Out</div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="dash-main">
    <div class="dash-topbar">
      <div class="topbar-title" id="topbarTitle">Dashboard</div>
      <div class="topbar-actions">
        <div class="notif-bell" onclick="showPanel('notifications')">üîî<div class="dot hidden" id="notifDot"></div></div>
        <div style="font-size:13px;color:var(--text2);" id="topbarEmail"></div>
      </div>
    </div>
    <div class="dash-content">

      <!-- HOME PANEL -->
      <div class="panel active" id="panel-home">
        <div class="upgrade-banner" id="upgradeBanner">
          <div>
            <h3>‚≠ê Upgrade to Premium</h3>
            <p>Unlock custom logos, frames, colors, unlimited QR codes & links, and advanced analytics ‚Äî for just ‚Ç¶2,000 one-time!</p>
          </div>
          <button class="btn btn-primary" onclick="showPanel('upgrade')" style="white-space:nowrap;">Upgrade Now ‚Üí</button>
        </div>
        <div class="stats-grid">
          <div class="stat-card"><div class="stat-icon">‚¨ú</div><div class="stat-value" id="statQR">0</div><div class="stat-label">QR Codes Created</div></div>
          <div class="stat-card"><div class="stat-icon">üîó</div><div class="stat-value" id="statLinks">0</div><div class="stat-label">Short Links</div></div>
          <div class="stat-card"><div class="stat-icon">üëÅÔ∏è</div><div class="stat-value" id="statScans">0</div><div class="stat-label">Total Scans</div></div>
          <div class="stat-card"><div class="stat-icon">üñ±Ô∏è</div><div class="stat-value" id="statClicks">0</div><div class="stat-label">Link Clicks</div></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
          <div class="card">
            <div class="card-title">Quick Actions</div>
            <div style="display:grid;gap:10px;margin-top:16px;">
              <button class="btn btn-secondary" onclick="showPanel('qr')" style="justify-content:flex-start;gap:12px;">‚¨ú Create QR Code</button>
              <button class="btn btn-secondary" onclick="showPanel('links')" style="justify-content:flex-start;gap:12px;">üîó Shorten a Link</button>
              <button class="btn btn-secondary" onclick="showPanel('analytics')" style="justify-content:flex-start;gap:12px;">üìä View Analytics</button>
            </div>
          </div>
          <div class="card">
            <div class="card-title">Recent Activity</div>
            <div id="recentActivity" style="margin-top:12px;"><p style="color:var(--text3);font-size:13px;">No activity yet. Create your first QR code!</p></div>
          </div>
        </div>
      </div>

      <!-- QR PANEL -->
      <div class="panel" id="panel-qr">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:6px;">QR Code Generator</h2>
        <p style="color:var(--text2);font-size:13px;margin-bottom:24px;">Create stunning QR codes for any purpose</p>
        <div class="qr-layout">
          <div>
            <div class="card" style="margin-bottom:16px;">
              <div class="card-title" style="margin-bottom:12px;">QR Type</div>
              <div class="qr-type-grid">
                <div class="qr-type-btn active" onclick="setQRType('url',this)"><span class="qti">üîó</span>URL</div>
                <div class="qr-type-btn" onclick="setQRType('text',this)"><span class="qti">üìù</span>Text</div>
                <div class="qr-type-btn" onclick="setQRType('wifi',this)"><span class="qti">üì∂</span>WiFi</div>
                <div class="qr-type-btn" onclick="setQRType('contact',this)"><span class="qti">üë§</span>Contact</div>
                <div class="qr-type-btn" onclick="setQRType('email',this)"><span class="qti">üìß</span>Email</div>
                <div class="qr-type-btn" onclick="setQRType('phone',this)"><span class="qti">üìû</span>Phone</div>
                <div class="qr-type-btn" onclick="setQRType('sms',this)"><span class="qti">üí¨</span>SMS</div>
                <div class="qr-type-btn" onclick="setQRType('location',this)"><span class="qti">üìç</span>Location</div>
              </div>
            </div>
            <div class="card" style="margin-bottom:16px;">
              <div class="card-title" style="margin-bottom:12px;">Content</div>
              <!-- URL -->
              <div id="qr-input-url">
                <div class="qr-form-group"><label>Website URL</label><input id="qrURL" type="url" class="form-input" placeholder="https://example.com" oninput="regenerateQR()"></div>
              </div>
              <!-- Text -->
              <div id="qr-input-text" class="hidden">
                <div class="qr-form-group"><label>Text / Message</label><textarea id="qrText" class="form-input" rows="3" placeholder="Enter any text‚Ä¶" oninput="regenerateQR()"></textarea></div>
              </div>
              <!-- WiFi -->
              <div id="qr-input-wifi" class="hidden">
                <div class="qr-form-group"><label>Network Name (SSID)</label><input id="qrWifiSSID" class="form-input" placeholder="MyWiFiNetwork" oninput="regenerateQR()"></div>
                <div class="qr-form-group"><label>Password</label><input id="qrWifiPass" type="password" class="form-input" placeholder="WiFi password" oninput="regenerateQR()"></div>
                <div class="qr-form-group"><label>Security</label><select id="qrWifiSec" class="form-input" onchange="regenerateQR()"><option>WPA</option><option>WEP</option><option>None</option></select></div>
              </div>
              <!-- Contact -->
              <div id="qr-input-contact" class="hidden">
                <div class="qr-form-group"><label>Full Name</label><input id="qrCName" class="form-input" placeholder="John Doe" oninput="regenerateQR()"></div>
                <div class="qr-form-group"><label>Phone</label><input id="qrCPhone" class="form-input" placeholder="+234..." oninput="regenerateQR()"></div>
                <div class="qr-form-group"><label>Email</label><input id="qrCEmail" class="form-input" placeholder="john@example.com" oninput="regenerateQR()"></div>
                <div class="qr-form-group"><label>Organization</label><input id="qrCOrg" class="form-input" placeholder="Company" oninput="regenerateQR()"></div>
              </div>
              <!-- Email -->
              <div id="qr-input-email" class="hidden">
                <div class="qr-form-group"><label>Email Address</label><input id="qrEmailAddr" class="form-input" placeholder="to@example.com" oninput="regenerateQR()"></div>
                <div class="qr-form-group"><label>Subject</label><input id="qrEmailSub" class="form-input" placeholder="Hello!" oninput="regenerateQR()"></div>
                <div class="qr-form-group"><label>Body</label><textarea id="qrEmailBody" class="form-input" rows="2" placeholder="Message body‚Ä¶" oninput="regenerateQR()"></textarea></div>
              </div>
              <!-- Phone -->
              <div id="qr-input-phone" class="hidden">
                <div class="qr-form-group"><label>Phone Number</label><input id="qrPhone" class="form-input" placeholder="+2348000000000" oninput="regenerateQR()"></div>
              </div>
              <!-- SMS -->
              <div id="qr-input-sms" class="hidden">
                <div class="qr-form-group"><label>Phone Number</label><input id="qrSMSPhone" class="form-input" placeholder="+2348000000000" oninput="regenerateQR()"></div>
                <div class="qr-form-group"><label>Message</label><textarea id="qrSMSMsg" class="form-input" rows="2" oninput="regenerateQR()"></textarea></div>
              </div>
              <!-- Location -->
              <div id="qr-input-location" class="hidden">
                <div class="qr-form-group"><label>Latitude</label><input id="qrLat" class="form-input" placeholder="6.5244" oninput="regenerateQR()"></div>
                <div class="qr-form-group"><label>Longitude</label><input id="qrLng" class="form-input" placeholder="3.3792" oninput="regenerateQR()"></div>
              </div>
            </div>

            <!-- Customization -->
            <div class="card">
              <div class="card-title" style="margin-bottom:4px;">Customization</div>
              <p style="font-size:12px;color:var(--text3);margin-bottom:16px;">‚≠ê Premium features marked with a star</p>
              <div class="section-divider"></div>

              <!-- Colors - premium -->
              <div class="premium-feature locked" id="colorSection">
                <div class="qr-form-group">
                  <label>Colors</label>
                  <div class="color-row">
                    <div class="color-item"><label>Foreground</label><input type="color" id="qrFgColor" value="#000000" oninput="regenerateQR()"></div>
                    <div class="color-item"><label>Background</label><input type="color" id="qrBgColor" value="#FFFFFF" oninput="regenerateQR()"></div>
                  </div>
                </div>
              </div>

              <div class="section-divider"></div>
              <!-- Shape - premium -->
              <div class="premium-feature locked" id="shapeSection">
                <div class="qr-form-group">
                  <label>Pixel Shape</label>
                  <div class="shape-grid">
                    <div class="shape-btn active" onclick="setShape('square',this)">‚óº Square</div>
                    <div class="shape-btn" onclick="setShape('rounded',this)">‚¨õ Rounded</div>
                    <div class="shape-btn" onclick="setShape('dots',this)">‚ö´ Dots</div>
                  </div>
                </div>
              </div>

              <div class="section-divider"></div>
              <!-- Frame - premium -->
              <div class="premium-feature locked" id="frameSection">
                <div class="qr-form-group">
                  <label>Frame</label>
                  <div class="frame-grid">
                    <div class="frame-btn active" onclick="setFrame(0,this)" title="No frame">üî≤</div>
                    <div class="frame-btn" onclick="setFrame(1,this)" title="Purple border">üü™</div>
                    <div class="frame-btn" onclick="setFrame(2,this)" title="Dashed cyan">üü¶</div>
                    <div class="frame-btn" onclick="setFrame(3,this)" title="Gold border">üü®</div>
                    <div class="frame-btn" onclick="setFrame(4,this)" title="Shadow">‚¨õ</div>
                  </div>
                </div>
              </div>

              <div class="section-divider"></div>
              <!-- Logo - premium -->
              <div class="premium-feature locked" id="logoSection">
                <div class="qr-form-group">
                  <label>Logo (PNG/JPG)</label>
                  <input type="file" id="qrLogo" accept="image/*" class="form-input" style="padding:8px;" onchange="regenerateQR()">
                </div>
              </div>

              <div class="section-divider"></div>
              <!-- Error Correction -->
              <div class="qr-form-group">
                <label>Error Correction</label>
                <select id="qrECC" class="error-select" onchange="regenerateQR()">
                  <option value="L">Low (7%)</option>
                  <option value="M" selected>Medium (15%)</option>
                  <option value="Q">Quartile (25%)</option>
                  <option value="H">High (30%)</option>
                </select>
              </div>
              <!-- Size -->
              <div class="qr-form-group">
                <label>Size: <span id="qrSizeVal">300</span>px</label>
                <input type="range" id="qrSize" min="150" max="600" value="300" oninput="document.getElementById('qrSizeVal').textContent=this.value;regenerateQR()" style="width:100%;accent-color:var(--primary);">
              </div>
            </div>
          </div>

          <!-- Preview -->
          <div class="qr-preview-card">
            <div class="card">
              <div class="card-title" style="margin-bottom:16px;">Preview</div>
              <div class="qr-canvas-wrap" id="qrCanvasWrap">
                <canvas id="qrCanvas"></canvas>
              </div>
              <div id="qrLoading" class="ai-loading hidden" style="justify-content:center;margin-bottom:12px;">Generating QR code‚Ä¶</div>
              <div style="display:flex;flex-direction:column;gap:8px;">
                <button class="btn btn-primary btn-full" onclick="downloadQR()">‚¨á Download PNG</button>
                <button class="btn btn-secondary btn-full" onclick="saveQRCode()">üíæ Save QR Code</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- LINKS PANEL -->
      <div class="panel" id="panel-links">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:6px;">Short Link Generator</h2>
        <p style="color:var(--text2);font-size:13px;margin-bottom:24px;">Create trackable short links instantly</p>
        <div class="links-layout">
          <div>
            <div class="card" style="margin-bottom:16px;">
              <div class="card-title" style="margin-bottom:16px;">Shorten a Link</div>
              <div class="form-group"><label class="form-label">Long URL</label><input id="longURL" type="url" class="form-input" placeholder="https://your-very-long-url.com/page?param=value"></div>
              <div class="premium-feature locked">
                <div class="form-group"><label class="form-label">Custom Alias (optional)</label><input id="customAlias" type="text" class="form-input" placeholder="my-custom-link" id="customAliasInput"></div>
              </div>
              <button class="btn btn-primary btn-full" onclick="shortenLink()" style="margin-top:8px;">‚úÇÔ∏è Shorten Link</button>
            </div>
            <div class="card" id="shortLinkResult" style="display:none;">
              <div class="card-title" style="margin-bottom:12px;">‚úÖ Link Created!</div>
              <div style="background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.2);border-radius:var(--r3);padding:14px;margin-bottom:12px;">
                <div style="font-size:12px;color:var(--text3);margin-bottom:4px;">Short Link:</div>
                <div id="shortLinkDisplay" style="font-size:15px;font-weight:600;color:var(--green);word-break:break-all;"></div>
              </div>
              <div style="display:flex;gap:8px;">
                <button class="btn btn-secondary" onclick="copyShortLink()" style="flex:1;">üìã Copy</button>
                <button class="btn btn-ghost" onclick="makeQRFromLink()" style="flex:1;">‚¨ú Make QR</button>
              </div>
            </div>
          </div>
          <div>
            <div class="card">
              <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;"><div class="card-title">My Links</div><span id="linkCountBadge" style="font-size:12px;color:var(--text3);"></span></div>
              <div id="linksList"><div class="empty"><div class="empty-icon">üîó</div><p>No links yet.<br>Create your first short link!</p></div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ANALYTICS PANEL -->
      <div class="panel" id="panel-analytics">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:24px;">Analytics</h2>
        <div class="analytics-grid">
          <div class="stat-card"><div class="stat-icon">‚¨ú</div><div class="stat-value" id="aStatQR">0</div><div class="stat-label">Total QR Codes</div></div>
          <div class="stat-card"><div class="stat-icon">üîó</div><div class="stat-value" id="aStatLinks">0</div><div class="stat-label">Total Short Links</div></div>
          <div class="stat-card"><div class="stat-icon">üëÅÔ∏è</div><div class="stat-value" id="aStatScans">0</div><div class="stat-label">QR Scans</div></div>
          <div class="stat-card"><div class="stat-icon">üñ±Ô∏è</div><div class="stat-value" id="aStatClicks">0</div><div class="stat-label">Link Clicks</div></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;">
          <div class="card">
            <div class="card-title">QR Code Performance</div>
            <div id="qrChart"><p style="color:var(--text3);font-size:13px;margin-top:12px;">Create QR codes to see performance data.</p></div>
          </div>
          <div class="card">
            <div class="card-title">Link Performance</div>
            <div id="linkChart"><p style="color:var(--text3);font-size:13px;margin-top:12px;">Create short links to see performance data.</p></div>
          </div>
        </div>
        <div class="card">
          <div class="card-title" style="margin-bottom:16px;">All QR Codes</div>
          <div id="analyticsQRList"><div class="empty"><div class="empty-icon">üìä</div><p>No QR codes yet</p></div></div>
        </div>
      </div>

      <!-- NOTIFICATIONS PANEL -->
      <div class="panel" id="panel-notifications">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:6px;">Notifications</h2>
        <p style="color:var(--text2);font-size:13px;margin-bottom:24px;">Updates and announcements from the Trisend team</p>
        <div id="notifList"><div class="empty"><div class="empty-icon">üîî</div><p>No notifications yet</p></div></div>
      </div>

      <!-- AI CHAT PANEL -->
      <div class="panel" id="panel-chat">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:6px;">AI Assistant</h2>
        <p style="color:var(--text2);font-size:13px;margin-bottom:20px;">Ask me anything about Trisend</p>
        <div class="chat-layout">
          <div class="chat-messages" id="chatMessages">
            <div class="chat-msg bot">
              <div class="chat-avatar">ü§ñ</div>
              <div class="chat-bubble">Hi there! üëã I'm Trisend AI. I can help you with QR codes, link shortening, analytics, your account, and anything else about Trisend. What would you like to know?</div>
            </div>
          </div>
          <div class="chat-input-bar">
            <textarea class="chat-input" id="chatInput" rows="1" placeholder="Ask me anything‚Ä¶" onkeydown="handleChatKey(event)"></textarea>
            <button class="chat-send" onclick="sendChat()">‚û§</button>
          </div>
        </div>
      </div>

      <!-- SETTINGS PANEL -->
      <div class="panel" id="panel-settings">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:24px;">Settings</h2>
        <div class="settings-grid">
          <div class="card">
            <div class="card-title" style="margin-bottom:16px;">Profile</div>
            <div class="form-group"><label class="form-label">Display Name</label><input id="settingsName" type="text" class="form-input" placeholder="Your name"></div>
            <div class="form-group"><label class="form-label">Email</label><input id="settingsEmail" type="email" class="form-input" disabled style="opacity:.6;cursor:not-allowed;"></div>
            <button class="btn btn-primary" onclick="saveSettings()">Save Changes</button>
          </div>
          <div class="card">
            <div class="card-title" style="margin-bottom:16px;">Your Plan</div>
            <div id="planInfo" style="margin-bottom:20px;"></div>
            <div id="planCTA"></div>
          </div>
          <div class="card">
            <div class="card-title" style="margin-bottom:16px;">Support</div>
            <p style="font-size:13px;color:var(--text2);margin-bottom:16px;">Need help? Our team is ready to assist you.</p>
            <a href="mailto:trisendmailer@gmail.com" style="display:block;"><button class="btn btn-secondary btn-full">‚úâÔ∏è Email Support</button></a>
            <button class="btn btn-ghost btn-full" onclick="showPanel('chat')" style="margin-top:8px;">ü§ñ Chat with AI</button>
          </div>
          <div class="card">
            <div class="card-title" style="margin-bottom:16px;">Report a Bug</div>
            <div class="form-group"><label class="form-label">Issue Title</label><input id="bugTitle" class="form-input" placeholder="Brief description"></div>
            <div class="form-group"><label class="form-label">Details</label><textarea id="bugDesc" class="form-input" rows="3" placeholder="Describe the issue‚Ä¶"></textarea></div>
            <button class="btn btn-red" onclick="submitBug()">üêõ Submit Report</button>
          </div>
        </div>
      </div>

      <!-- UPGRADE PANEL -->
      <div class="panel" id="panel-upgrade">
        <div class="upgrade-panel fade-in">
          <div style="font-size:64px;margin-bottom:20px;">‚≠ê</div>
          <h1 style="font-size:32px;font-weight:900;letter-spacing:-1px;margin-bottom:12px;">Upgrade to Premium</h1>
          <p style="color:var(--text2);font-size:16px;margin-bottom:8px;">One-time payment. Lifetime access. No subscriptions.</p>
          <div style="font-size:48px;font-weight:900;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin:20px 0;">‚Ç¶2,000</div>
          <div style="background:var(--card);border:1px solid var(--border2);border-radius:var(--r);padding:28px;margin:20px 0;text-align:left;">
            <h3 style="font-size:16px;font-weight:700;margin-bottom:16px;">Everything in Premium:</h3>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
              <div style="display:flex;gap:8px;align-items:center;font-size:14px;"><span style="color:var(--green);">‚úì</span>Unlimited QR codes</div>
              <div style="display:flex;gap:8px;align-items:center;font-size:14px;"><span style="color:var(--green);">‚úì</span>Unlimited short links</div>
              <div style="display:flex;gap:8px;align-items:center;font-size:14px;"><span style="color:var(--green);">‚úì</span>Custom QR colors</div>
              <div style="display:flex;gap:8px;align-items:center;font-size:14px;"><span style="color:var(--green);">‚úì</span>QR shapes (dots/rounded)</div>
              <div style="display:flex;gap:8px;align-items:center;font-size:14px;"><span style="color:var(--green);">‚úì</span>Logo in QR code</div>
              <div style="display:flex;gap:8px;align-items:center;font-size:14px;"><span style="color:var(--green);">‚úì</span>Beautiful QR frames</div>
              <div style="display:flex;gap:8px;align-items:center;font-size:14px;"><span style="color:var(--green);">‚úì</span>Custom link aliases</div>
              <div style="display:flex;gap:8px;align-items:center;font-size:14px;"><span style="color:var(--green);">‚úì</span>Advanced analytics</div>
              <div style="display:flex;gap:8px;align-items:center;font-size:14px;"><span style="color:var(--green);">‚úì</span>Priority support</div>
              <div style="display:flex;gap:8px;align-items:center;font-size:14px;"><span style="color:var(--green);">‚úì</span>Lifetime updates</div>
            </div>
          </div>
          <button class="btn btn-primary btn-lg" onclick="initiatePayment()" style="width:100%;font-size:17px;padding:18px;">üöÄ Upgrade for ‚Ç¶2,000 ‚Äî Pay Once</button>
          <p style="font-size:12px;color:var(--text3);margin-top:12px;">Secured by Paystack ¬∑ SSL Encrypted ¬∑ Instant Activation</p>
        </div>
      </div>

    </div><!-- end dash-content -->
  </div><!-- end dash-main -->
</div><!-- end dashboard -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADMIN DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="admin" class="hidden">
  <div class="admin-sidebar">
    <div class="sidebar-logo">
      <svg width="24" height="24" viewBox="0 0 72 72" fill="none"><defs><linearGradient id="adlg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#7C3AED"/><stop offset="100%" stop-color="#06B6D4"/></linearGradient></defs><rect width="72" height="72" rx="18" fill="url(#adlg)"/><rect x="8" y="8" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="12" y="12" width="12" height="12" fill="url(#adlg)"/><rect x="15" y="15" width="6" height="6" fill="white"/><rect x="44" y="8" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="48" y="12" width="12" height="12" fill="url(#adlg)"/><rect x="51" y="15" width="6" height="6" fill="white"/><rect x="8" y="44" width="20" height="20" rx="4" fill="white" opacity=".95"/><rect x="12" y="48" width="12" height="12" fill="url(#adlg)"/><rect x="15" y="51" width="6" height="6" fill="white"/></svg>
      Admin
    </div>
    <nav class="sidebar-nav">
      <div class="nav-item active" onclick="showAdminPanel('overview')"><span class="nav-icon">üìä</span>Overview</div>
      <div class="nav-item" onclick="showAdminPanel('users')"><span class="nav-icon">üë•</span>Users</div>
      <div class="nav-item" onclick="showAdminPanel('notifications')"><span class="nav-icon">üîî</span>Send Notifications</div>
      <div class="nav-item" onclick="showAdminPanel('chats')"><span class="nav-icon">üí¨</span>AI Chats</div>
      <div class="nav-item" onclick="showAdminPanel('bugs')"><span class="nav-icon">üêõ</span>Bug Reports</div>
      <div class="nav-item" onclick="showAdminPanel('system')"><span class="nav-icon">‚öôÔ∏è</span>System</div>
    </nav>
    <div class="sidebar-bottom">
      <div class="nav-item" onclick="goToDashboard()"><span class="nav-icon">üè†</span>My Dashboard</div>
      <div class="nav-item" onclick="doLogout()" style="color:#EF4444;"><span class="nav-icon">üö™</span>Log Out</div>
    </div>
  </div>
  <div class="admin-main">
    <div class="admin-topbar">
      <h2>üõ°Ô∏è Trisend Admin ‚Äî Command Center</h2>
      <div style="font-size:13px;color:var(--text2);" id="adminUserEmail"></div>
    </div>
    <div class="admin-content">

      <!-- OVERVIEW -->
      <div class="admin-panel active" id="apanel-overview">
        <div class="ceo-welcome">
          <div class="ceo-avatar">üëë</div>
          <div class="ceo-info">
            <h3>Welcome back, CEO Tomiwa! üëã</h3>
            <p>Here's a live overview of your Trisend platform. Everything is running smoothly.</p>
          </div>
        </div>
        <div class="admin-stat-grid">
          <div class="stat-card"><div class="stat-icon">üë•</div><div class="stat-value" id="adStatUsers">‚Äì</div><div class="stat-label">Total Users</div></div>
          <div class="stat-card"><div class="stat-icon">‚≠ê</div><div class="stat-value" id="adStatPremium">‚Äì</div><div class="stat-label">Premium Users</div></div>
          <div class="stat-card"><div class="stat-icon">‚¨ú</div><div class="stat-value" id="adStatQRTotal">‚Äì</div><div class="stat-label">QR Codes</div></div>
          <div class="stat-card"><div class="stat-icon">üîó</div><div class="stat-value" id="adStatLinksTotal">‚Äì</div><div class="stat-label">Short Links</div></div>
          <div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-value" id="adStatRevenue">‚Äì</div><div class="stat-label">Est. Revenue</div></div>
          <div class="stat-card"><div class="stat-icon">üêõ</div><div class="stat-value" id="adStatBugs">‚Äì</div><div class="stat-label">Open Bugs</div></div>
        </div>
        <div class="card">
          <div class="card-title" style="margin-bottom:16px;">Recent Signups</div>
          <div id="recentSignups"><p style="color:var(--text3);font-size:13px;">Loading‚Ä¶</p></div>
        </div>
      </div>

      <!-- USERS -->
      <div class="admin-panel" id="apanel-users">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
          <h2 style="font-size:20px;font-weight:800;">User Management</h2>
          <input type="text" class="form-input" placeholder="Search users‚Ä¶" id="userSearch" style="width:240px;" oninput="filterUsers()">
        </div>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Name</th><th>Email</th><th>Plan</th><th>Role</th><th>Joined</th><th>Actions</th></tr></thead>
            <tbody id="usersTable"><tr><td colspan="6" style="text-align:center;color:var(--text3);">Loading users‚Ä¶</td></tr></tbody>
          </table>
        </div>
      </div>

      <!-- NOTIFICATIONS -->
      <div class="admin-panel" id="apanel-notifications">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:20px;">Send Notification</h2>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;">
          <div class="card">
            <div class="card-title" style="margin-bottom:16px;">Compose Notification</div>
            <div class="notif-form">
              <div class="form-group"><label class="form-label">Title</label><input id="ntTitle" class="form-input" placeholder="Notification title"></div>
              <div class="form-group"><label class="form-label">Message</label><textarea id="ntMsg" class="form-input" rows="4" placeholder="Write your message‚Ä¶"></textarea></div>
              <div class="form-group"><label class="form-label">Type</label>
                <select id="ntType" class="form-input">
                  <option value="info">‚ÑπÔ∏è Info</option>
                  <option value="upgrade">‚≠ê Upgrade Reminder</option>
                  <option value="feature">üéâ New Feature</option>
                  <option value="warning">‚ö†Ô∏è Warning</option>
                  <option value="system">üîß System</option>
                </select>
              </div>
              <div class="form-group"><label class="form-label">Target</label>
                <select id="ntTarget" class="form-input">
                  <option value="all">All Users</option>
                  <option value="free">Free Users Only</option>
                  <option value="premium">Premium Users Only</option>
                </select>
              </div>
              <button class="btn btn-primary" onclick="sendAdminNotif()">üì§ Send Notification</button>
            </div>
          </div>
          <div class="card">
            <div class="card-title" style="margin-bottom:16px;">Notification History</div>
            <div id="notifHistory"><p style="color:var(--text3);font-size:13px;">Loading‚Ä¶</p></div>
          </div>
        </div>
      </div>

      <!-- AI CHATS -->
      <div class="admin-panel" id="apanel-chats">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:20px;">User AI Conversations</h2>
        <div style="display:grid;grid-template-columns:280px 1fr;gap:16px;">
          <div class="card" style="height:fit-content;">
            <div class="card-title" style="margin-bottom:12px;">Users with Chats</div>
            <div id="chatUserList"><p style="color:var(--text3);font-size:13px;">Loading‚Ä¶</p></div>
          </div>
          <div class="card">
            <div class="card-title" style="margin-bottom:12px;" id="viewingChatTitle">Select a user to view their conversation</div>
            <div id="adminChatView" style="min-height:300px;background:var(--bg3);border-radius:var(--r3);padding:16px;overflow-y:auto;max-height:500px;">
              <p style="color:var(--text3);font-size:13px;text-align:center;padding:60px 0;">Select a user from the left ‚Üí</p>
            </div>
          </div>
        </div>
      </div>

      <!-- BUGS -->
      <div class="admin-panel" id="apanel-bugs">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:20px;">Bug Reports</h2>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Title</th><th>Reported By</th><th>Status</th><th>Date</th><th>Actions</th></tr></thead>
            <tbody id="bugsTable"><tr><td colspan="5" style="text-align:center;color:var(--text3);">Loading‚Ä¶</td></tr></tbody>
          </table>
        </div>
      </div>

      <!-- SYSTEM -->
      <div class="admin-panel" id="apanel-system">
        <h2 style="font-size:20px;font-weight:800;margin-bottom:20px;">System Management</h2>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
          <div class="card">
            <div class="card-title" style="margin-bottom:16px;">‚öôÔ∏è Platform Settings</div>
            <div class="form-group"><label class="form-label">Platform Status</label>
              <select class="form-input" id="platformStatus"><option>Online (All Systems Normal)</option><option>Maintenance Mode</option><option>Degraded Performance</option></select>
            </div>
            <div class="form-group"><label class="form-label">Free Plan QR Limit</label><input class="form-input" type="number" value="10" id="freeQRLimit"></div>
            <div class="form-group"><label class="form-label">Free Plan Link Limit</label><input class="form-input" type="number" value="20" id="freeLinkLimit"></div>
            <button class="btn btn-primary" onclick="saveSystemSettings()">Save Settings</button>
          </div>
          <div class="card">
            <div class="card-title" style="margin-bottom:16px;">üìÖ Scheduled Reminders</div>
            <p style="font-size:13px;color:var(--text2);margin-bottom:16px;">Set up automated upgrade reminders for free users.</p>
            <div class="form-group"><label class="form-label">Reminder Message</label><textarea class="form-input" rows="3" id="reminderMsg" placeholder="Hey! Did you know Premium is just ‚Ç¶2,000 once?">Hey! üëã Did you know Trisend Premium is just ‚Ç¶2,000 ‚Äî one-time payment, lifetime access? Upgrade today to unlock custom QR codes, frames, logos, and more!</textarea></div>
            <div class="form-group"><label class="form-label">Send To</label><select class="form-input"><option>All Free Users</option></select></div>
            <button class="btn btn-secondary" onclick="sendReminder()">üì§ Send Reminder Now</button>
          </div>
          <div class="card">
            <div class="card-title" style="margin-bottom:16px;">üëë Grant Premium Access</div>
            <p style="font-size:13px;color:var(--text2);margin-bottom:16px;">Manually grant premium to a user by email.</p>
            <div class="form-group"><label class="form-label">User Email</label><input id="grantEmail" class="form-input" placeholder="user@example.com"></div>
            <button class="btn btn-primary" onclick="grantPremium()">‚≠ê Grant Premium</button>
          </div>
          <div class="card">
            <div class="card-title" style="margin-bottom:16px;">üõ°Ô∏è Admin Management</div>
            <p style="font-size:13px;color:var(--text2);margin-bottom:16px;">Grant admin role to a user.</p>
            <div class="form-group"><label class="form-label">User Email</label><input id="adminGrantEmail" class="form-input" placeholder="admin@example.com"></div>
            <button class="btn btn-secondary" onclick="grantAdmin()">üõ°Ô∏è Grant Admin Role</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SCRIPTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
// ‚îÄ‚îÄ‚îÄ Firebase Config ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const fbConfig = {
  apiKey:"AIzaSyCgaYVSaKtXAQOVRTRfAGV6cWjPqG9x4Tc",
  authDomain:"trisend-e7250.firebaseapp.com",
  projectId:"trisend-e7250",
  storageBucket:"trisend-e7250.firebasestorage.app",
  messagingSenderId:"1088068014414",
  appId:"1:1088068014414:web:77c1f5c1de544b6ab5ce1f"
};
firebase.initializeApp(fbConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const PAYSTACK_PK = 'pk_live_795c60d1769a1ebef31e9705886a91f84de3144d';

// ‚îÄ‚îÄ‚îÄ App State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentUser = null, userDoc = null, currentQRType = 'url', qrShape = 'square', qrFrame = 0, allUsers = [];
const $ = id => document.getElementById(id);

// ‚îÄ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function show(id){ const el=$(id); if(el) el.classList.remove('hidden'); }
function hide(id){ const el=$(id); if(el) el.classList.add('hidden'); }
function showEls(...ids){ ids.forEach(show); }
function hideEls(...ids){ ids.forEach(hide); }

function toast(msg,type='info'){
  const el=document.createElement('div');
  el.className=`toast ${type}`;
  const icons={success:'‚úÖ',error:'‚ùå',info:'üí°'};
  el.innerHTML=`<span>${icons[type]||'üí°'}</span><span>${msg}</span>`;
  $('toastContainer').appendChild(el);
  setTimeout(()=>el.remove(),3500);
}

function loader(show_){
  if(show_) show('globalLoader');
  else hide('globalLoader');
}

function scrollTo(sel){
  const el=document.querySelector(sel);
  if(el) el.scrollIntoView({behavior:'smooth'});
}

function genCode(len=7){
  const chars='abcdefghijklmnopqrstuvwxyz0123456789';
  let r='';
  for(let i=0;i<len;i++) r+=chars[Math.floor(Math.random()*chars.length)];
  return r;
}

function timeAgo(ts){
  if(!ts) return 'Unknown';
  const d = ts.toDate ? ts.toDate() : new Date(ts);
  const diff=(Date.now()-d)/1000;
  if(diff<60) return 'just now';
  if(diff<3600) return Math.floor(diff/60)+'m ago';
  if(diff<86400) return Math.floor(diff/3600)+'h ago';
  return Math.floor(diff/86400)+'d ago';
}

// ‚îÄ‚îÄ‚îÄ Auth ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showAuth(tab='login'){
  show('authModal');
  switchAuthTab(tab);
}
function hideAuth(){ hide('authModal'); }

function switchAuthTab(tab){
  $('tabLogin').classList.toggle('active', tab==='login');
  $('tabSignup').classList.toggle('active', tab==='signup');
  $('loginForm').classList.toggle('hidden', tab!=='login');
  $('signupForm').classList.toggle('hidden', tab!=='signup');
}

async function doLogin(){
  const email=$('loginEmail').value.trim(), pass=$('loginPass').value;
  if(!email||!pass){ toast('Please fill all fields','error'); return; }
  loader(true);
  try{
    await auth.signInWithEmailAndPassword(email,pass);
  } catch(e){ loader(false); toast(e.message,'error'); }
}

async function doSignup(){
  const name=$('signupName').value.trim(), email=$('signupEmail').value.trim(), pass=$('signupPass').value;
  if(!name||!email||!pass){ toast('Please fill all fields','error'); return; }
  if(pass.length<8){ toast('Password must be at least 8 characters','error'); return; }
  loader(true);
  try{
    const cred = await auth.createUserWithEmailAndPassword(email,pass);
    await cred.user.updateProfile({displayName:name});
    await createUserDoc(cred.user, name);
  } catch(e){ loader(false); toast(e.message,'error'); }
}

async function doGoogleAuth(){
  loader(true);
  try{
    const provider = new firebase.auth.GoogleAuthProvider();
    const cred = await auth.signInWithPopup(provider);
    const snap = await db.collection('users').doc(cred.user.uid).get();
    if(!snap.exists) await createUserDoc(cred.user, cred.user.displayName);
  } catch(e){ loader(false); toast(e.message,'error'); }
}

async function createUserDoc(user, name){
  await db.collection('users').doc(user.uid).set({
    displayName: name||user.displayName||'User',
    email: user.email,
    photoURL: user.photoURL||'',
    plan: 'free',
    role: 'user',
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    qrCount:0, linkCount:0
  });
}

async function doLogout(){
  await auth.signOut();
  showLanding();
}

function goToDashboard(){
  hide('admin');
  show('dashboard');
}

// ‚îÄ‚îÄ‚îÄ Auth State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
auth.onAuthStateChanged(async user=>{
  if(user){
    currentUser=user;
    loader(true);
    const snap = await db.collection('users').doc(user.uid).get();
    if(snap.exists){
      userDoc = snap.data();
    } else {
      await createUserDoc(user, user.displayName);
      userDoc = {plan:'free', role:'user', displayName:user.displayName||'User', email:user.email};
    }
    hideAuth();
    hide('landing');
    // Check short link redirect first
    const hash = location.hash;
    if(hash.startsWith('#/r/')){
      handleRedirect(hash.replace('#/r/',''));
      return;
    }
    if(userDoc.role==='admin') showAdminDash();
    else showDash();
  } else {
    currentUser=null; userDoc=null;
    // Check for link redirect even when not logged in
    const hash = location.hash;
    if(hash.startsWith('#/r/')){
      handleRedirect(hash.replace('#/r/',''));
      return;
    }
    showLanding();
  }
});

// ‚îÄ‚îÄ‚îÄ Short link redirect ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function handleRedirect(code){
  loader(true);
  try{
    const snap = await db.collection('shortlinks').doc(code).get();
    if(snap.exists){
      const d=snap.data();
      await db.collection('shortlinks').doc(code).update({clicks: firebase.firestore.FieldValue.increment(1)});
      await db.collection('link_events').add({linkCode:code, timestamp:firebase.firestore.FieldValue.serverTimestamp(), ua:navigator.userAgent});
      location.href = d.originalUrl;
    } else {
      loader(false); toast('Short link not found','error');
      showLanding();
    }
  } catch(e){ loader(false); showLanding(); }
}

// ‚îÄ‚îÄ‚îÄ Landing ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showLanding(){
  loader(false);
  hide('dashboard'); hide('admin');
  show('landing');
}

function showSupport(){
  if(currentUser) showPanel('chat');
  else showAuth('signup');
}

// ‚îÄ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showDash(){
  hide('landing'); hide('admin');
  show('dashboard');
  hide('globalLoader');
  initDash();
}

function initDash(){
  const u=currentUser, doc=userDoc;
  const name=doc.displayName||u.displayName||'User';
  const email=u.email||'';
  $('sidebarName').textContent=name;
  $('sidebarEmail').textContent=email;
  $('topbarEmail').textContent=email;
  $('settingsName').value=name;
  $('settingsEmail').value=email;
  const av=$('sidebarAvatar');
  if(doc.photoURL||u.photoURL){ av.innerHTML=`<img src="${doc.photoURL||u.photoURL}" alt="">`; }
  else { av.textContent=name[0].toUpperCase(); }
  const isPremium=doc.plan==='premium';
  const planBadge=$('sidebarPlan');
  planBadge.className='sidebar-plan '+(isPremium?'plan-premium':'plan-free');
  planBadge.textContent=isPremium?'‚≠ê Premium':'Free';
  if(isPremium){
    hide('upgradeBanner');
    $('upgradeNavItem').style.display='none';
    enablePremiumFeatures();
  } else {
    show('upgradeBanner');
    disablePremiumFeatures();
  }
  $('planInfo').innerHTML=isPremium
    ? `<div style="background:linear-gradient(135deg,rgba(124,58,237,.15),rgba(6,182,212,.1));border:1px solid var(--border);border-radius:var(--r3);padding:16px;"><div style="font-size:22px;font-weight:800;margin-bottom:4px;">‚≠ê Premium</div><p style="font-size:13px;color:var(--text2);">Lifetime access ¬∑ All features unlocked</p></div>`
    : `<div style="background:rgba(255,255,255,.04);border:1px solid var(--border2);border-radius:var(--r3);padding:16px;"><div style="font-size:22px;font-weight:800;margin-bottom:4px;">Free Plan</div><p style="font-size:13px;color:var(--text2);">Limited features ¬∑ Upgrade to unlock everything</p></div>`;
  $('planCTA').innerHTML=isPremium?'':'<button class="btn btn-primary btn-full" onclick="showPanel(\'upgrade\')">‚≠ê Upgrade to Premium</button>';
  if(userDoc.role==='admin'){
    const adminNav=$('adminNav');
    if(adminNav){ adminNav.style.display='flex'; adminNav.onclick=()=>{hide('dashboard');show('admin');showAdminDash();}; }
  }
  loadDashStats();
  loadNotifications();
  initQR();
}

async function loadDashStats(){
  try{
    const [qrSnap,linkSnap] = await Promise.all([
      db.collection('qrcodes').where('userId','==',currentUser.uid).get(),
      db.collection('shortlinks').where('userId','==',currentUser.uid).get()
    ]);
    const qrCount=qrSnap.size, linkCount=linkSnap.size;
    let scans=0, clicks=0;
    qrSnap.forEach(d=>scans+=(d.data().scans||0));
    linkSnap.forEach(d=>clicks+=(d.data().clicks||0));
    ['statQR','aStatQR'].forEach(id=>$(id)&&($(id).textContent=qrCount));
    ['statLinks','aStatLinks'].forEach(id=>$(id)&&($(id).textContent=linkCount));
    ['statScans','aStatScans'].forEach(id=>$(id)&&($(id).textContent=scans));
    ['statClicks','aStatClicks'].forEach(id=>$(id)&&($(id).textContent=clicks));
    renderAnalytics(qrSnap, linkSnap);
  } catch(e){}
}

function renderAnalytics(qrSnap, linkSnap){
  // QR chart
  const qrItems=[];
  qrSnap.forEach(d=>qrItems.push(d.data()));
  if(qrItems.length){
    const max=Math.max(...qrItems.map(q=>q.scans||0),1);
    $('qrChart').innerHTML='<div class="chart-bar-wrap">'+qrItems.slice(0,6).map(q=>{
      const pct=Math.round((q.scans||0)/max*100);
      return `<div class="chart-bar-item"><div class="bar-label" title="${q.label||q.type}">${(q.label||q.type||'QR').slice(0,8)}</div><div class="chart-bar-track"><div class="chart-bar-fill" style="width:${pct}%"></div></div><div class="chart-bar-val">${q.scans||0}</div></div>`;
    }).join('')+'</div>';
    $('analyticsQRList').innerHTML=qrItems.map(q=>`<div class="link-item"><h4>${q.label||q.type||'QR Code'}</h4><div class="link-meta"><span>Type: ${q.type}</span><span>Scans: ${q.scans||0}</span><span>${timeAgo(q.createdAt)}</span></div></div>`).join('');
  }
  // Link chart
  const linkItems=[];
  linkSnap.forEach(d=>linkItems.push({id:d.id,...d.data()}));
  if(linkItems.length){
    const max=Math.max(...linkItems.map(l=>l.clicks||0),1);
    $('linkChart').innerHTML='<div class="chart-bar-wrap">'+linkItems.slice(0,6).map(l=>{
      const pct=Math.round((l.clicks||0)/max*100);
      return `<div class="chart-bar-item"><div class="bar-label">${l.code||'link'}</div><div class="chart-bar-track"><div class="chart-bar-fill" style="width:${pct}%"></div></div><div class="chart-bar-val">${l.clicks||0}</div></div>`;
    }).join('')+'</div>';
    renderLinksList(linkItems);
  }
}

function showPanel(p){
  document.querySelectorAll('.panel').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.nav-item[data-panel]').forEach(el=>el.classList.toggle('active',el.dataset.panel===p));
  const panel=$(`panel-${p}`);
  if(panel) panel.classList.add('active');
  const titles={home:'Dashboard',qr:'QR Generator',links:'Short Links',analytics:'Analytics',notifications:'Notifications',chat:'AI Assistant',settings:'Settings',upgrade:'Upgrade to Premium'};
  $('topbarTitle').textContent=titles[p]||p;
  if(p==='links') loadLinks();
  if(p==='analytics') loadDashStats();
  if(p==='notifications') loadNotifications();
}

// ‚îÄ‚îÄ‚îÄ QR Generator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initQR(){ regenerateQR(); }

function setQRType(type, btn){
  currentQRType=type;
  document.querySelectorAll('.qr-type-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  ['url','text','wifi','contact','email','phone','sms','location'].forEach(t=>{
    const el=$(`qr-input-${t}`);
    if(el) el.classList.toggle('hidden',t!==type);
  });
  regenerateQR();
}

function setShape(s,btn){
  qrShape=s;
  document.querySelectorAll('.shape-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  regenerateQR();
}

function setFrame(f,btn){
  qrFrame=f;
  document.querySelectorAll('.frame-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  regenerateQR();
}

function getQRData(){
  switch(currentQRType){
    case 'url': { const u=$('qrURL').value.trim(); return u?(u.startsWith('http')?u:'https://'+u):''; }
    case 'text': return $('qrText').value.trim();
    case 'wifi': { const s=$('qrWifiSSID').value,p=$('qrWifiPass').value,t=$('qrWifiSec').value; return s?`WIFI:T:${t};S:${s};P:${p};;`:''; }
    case 'contact': { const n=$('qrCName').value,ph=$('qrCPhone').value,em=$('qrCEmail').value,org=$('qrCOrg').value; return n?`BEGIN:VCARD\nVERSION:3.0\nFN:${n}\nTEL:${ph}\nEMAIL:${em}\nORG:${org}\nEND:VCARD`:''; }
    case 'email': { const a=$('qrEmailAddr').value,s=$('qrEmailSub').value,b=$('qrEmailBody').value; return a?`mailto:${a}?subject=${encodeURIComponent(s)}&body=${encodeURIComponent(b)}`:''; }
    case 'phone': return $('qrPhone').value?`tel:${$('qrPhone').value}`:'';
    case 'sms': { const p=$('qrSMSPhone').value,m=$('qrSMSMsg').value; return p?`smsto:${p}:${m}`:''; }
    case 'location': { const la=$('qrLat').value,ln=$('qrLng').value; return la&&ln?`geo:${la},${ln}`:''; }
    default: return '';
  }
}

function regenerateQR(){
  const data=getQRData();
  const canvas=$('qrCanvas');
  if(!data){ canvas.width=0;canvas.height=0; return; }
  show('qrLoading');
  const size=parseInt($('qrSize').value)||300;
  const isPremium=userDoc&&userDoc.plan==='premium';
  const fg=isPremium?$('qrFgColor').value:'#000000';
  const bg=isPremium?$('qrBgColor').value:'#FFFFFF';
  const ecc=$('qrECC').value;
  setTimeout(()=>{
    try{
      const qr=new QRious({element:canvas,value:data,size:size,foreground:fg,background:bg,level:ecc});
      if(isPremium){
        applyShape(canvas,fg,bg,qrShape);
        applyLogo(canvas);
        applyFrame(canvas,qrFrame,size);
      }
    } catch(e){}
    hide('qrLoading');
  },100);
}

function applyShape(canvas,fg,bg,shape){
  if(shape==='square') return;
  const ctx=canvas.getContext('2d');
  const img=new Image();
  img.src=canvas.toDataURL();
  img.onload=()=>{
    const size=canvas.width;
    ctx.clearRect(0,0,size,size);
    ctx.fillStyle=bg;
    ctx.fillRect(0,0,size,size);
    const moduleSize=Math.round(size/37);
    const tempCanvas=document.createElement('canvas');
    tempCanvas.width=size; tempCanvas.height=size;
    const tc=tempCanvas.getContext('2d');
    tc.drawImage(img,0,0);
    const imgData=tc.getImageData(0,0,size,size);
    for(let y=0;y<size;y+=moduleSize){
      for(let x=0;x<size;x+=moduleSize){
        const px=(y*size+x)*4;
        const isDark=imgData.data[px]<128;
        if(isDark){
          ctx.fillStyle=fg;
          if(shape==='dots'){
            ctx.beginPath();
            ctx.arc(x+moduleSize/2,y+moduleSize/2,moduleSize/2*.85,0,Math.PI*2);
            ctx.fill();
          } else if(shape==='rounded'){
            const r=moduleSize*.3;
            ctx.beginPath();
            ctx.moveTo(x+r,y);
            ctx.lineTo(x+moduleSize-r,y);
            ctx.quadraticCurveTo(x+moduleSize,y,x+moduleSize,y+r);
            ctx.lineTo(x+moduleSize,y+moduleSize-r);
            ctx.quadraticCurveTo(x+moduleSize,y+moduleSize,x+moduleSize-r,y+moduleSize);
            ctx.lineTo(x+r,y+moduleSize);
            ctx.quadraticCurveTo(x,y+moduleSize,x,y+moduleSize-r);
            ctx.lineTo(x,y+r);
            ctx.quadraticCurveTo(x,y,x+r,y);
            ctx.closePath();
            ctx.fill();
          }
        }
      }
    }
  };
}

function applyLogo(canvas){
  const fileInput=$('qrLogo');
  if(!fileInput||!fileInput.files[0]) return;
  const reader=new FileReader();
  reader.onload=e=>{
    const img=new Image();
    img.onload=()=>{
      const ctx=canvas.getContext('2d');
      const size=canvas.width;
      const logoSize=size*.22;
      const x=(size-logoSize)/2, y=(size-logoSize)/2;
      ctx.fillStyle='#fff';
      ctx.fillRect(x-4,y-4,logoSize+8,logoSize+8);
      ctx.drawImage(img,x,y,logoSize,logoSize);
    };
    img.src=e.target.result;
  };
  reader.readAsDataURL(fileInput.files[0]);
}

function applyFrame(canvas,frame,size){
  if(!frame) return;
  const ctx=canvas.getContext('2d');
  const frames=[
    null,
    ()=>{ctx.strokeStyle='#7C3AED';ctx.lineWidth=8;ctx.strokeRect(4,4,size-8,size-8);},
    ()=>{ctx.strokeStyle='#06B6D4';ctx.lineWidth=6;ctx.setLineDash([12,6]);ctx.strokeRect(4,4,size-8,size-8);ctx.setLineDash([]);},
    ()=>{ctx.strokeStyle='#F59E0B';ctx.lineWidth=10;ctx.strokeRect(5,5,size-10,size-10);},
    ()=>{ctx.strokeStyle='#1E293B';ctx.lineWidth=8;ctx.strokeRect(4,4,size-8,size-8);ctx.shadowColor='#7C3AED';ctx.shadowBlur=16;ctx.strokeRect(4,4,size-8,size-8);ctx.shadowBlur=0;}
  ];
  if(frames[frame]) frames[frame]();
}

function downloadQR(){
  const canvas=$('qrCanvas');
  if(!canvas.width){ toast('Generate a QR code first','error'); return; }
  const link=document.createElement('a');
  link.download=`trisend-qr-${Date.now()}.png`;
  link.href=canvas.toDataURL('image/png');
  link.click();
  toast('QR Code downloaded!','success');
}

async function saveQRCode(){
  if(!currentUser){ toast('Please log in','error'); return; }
  const data=getQRData();
  if(!data){ toast('Nothing to save ‚Äî enter some content first','error'); return; }
  const isPremium=userDoc&&userDoc.plan==='premium';
  if(!isPremium){
    const snap=await db.collection('qrcodes').where('userId','==',currentUser.uid).get();
    if(snap.size>=10){ toast('Free plan limit: 10 QR codes. Upgrade to save more!','error'); showPanel('upgrade'); return; }
  }
  try{
    await db.collection('qrcodes').add({userId:currentUser.uid,type:currentQRType,data,label:data.slice(0,40),scans:0,createdAt:firebase.firestore.FieldValue.serverTimestamp()});
    toast('QR Code saved!','success');
    loadDashStats();
  } catch(e){ toast('Error saving QR code','error'); }
}

function enablePremiumFeatures(){
  ['colorSection','shapeSection','frameSection','logoSection'].forEach(id=>{
    const el=$(id);
    if(el) el.classList.remove('locked');
  });
  const alias=$('customAlias');
  if(alias) alias.disabled=false;
}

function disablePremiumFeatures(){
  ['colorSection','shapeSection','frameSection','logoSection'].forEach(id=>{
    const el=$(id);
    if(el) el.classList.add('locked');
  });
  // Disable controls
  ['qrFgColor','qrBgColor','qrLogo'].forEach(id=>{
    const el=$(id);
    if(el) el.disabled=true;
  });
  document.querySelectorAll('.shape-btn,.frame-btn').forEach(el=>el.style.pointerEvents='none');
  const alias=$('customAlias');
  if(alias){ alias.disabled=true; alias.placeholder='Custom aliases ‚Äî Premium only ‚≠ê'; }
}

// ‚îÄ‚îÄ‚îÄ Link Shortener ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function shortenLink(){
  if(!currentUser){ toast('Please log in','error'); return; }
  const url=$('longURL').value.trim();
  if(!url){ toast('Enter a URL to shorten','error'); return; }
  let finalUrl=url.startsWith('http')?url:'https://'+url;
  const isPremium=userDoc&&userDoc.plan==='premium';
  if(!isPremium){
    const snap=await db.collection('shortlinks').where('userId','==',currentUser.uid).get();
    if(snap.size>=20){ toast('Free plan limit: 20 links. Upgrade for unlimited!','error'); showPanel('upgrade'); return; }
  }
  let code=genCode();
  const aliasInput=$('customAlias');
  if(isPremium && aliasInput&&aliasInput.value.trim()){
    code=aliasInput.value.trim().replace(/[^a-z0-9-]/gi,'').toLowerCase();
    const existing=await db.collection('shortlinks').doc(code).get();
    if(existing.exists){ toast('That alias is already taken. Try another.','error'); return; }
  }
  loader(true);
  try{
    await db.collection('shortlinks').doc(code).set({
      userId:currentUser.uid, originalUrl:finalUrl, code, clicks:0,
      createdAt:firebase.firestore.FieldValue.serverTimestamp()
    });
    loader(false);
    const base=location.origin+location.pathname;
    const shortUrl=`${base}#/r/${code}`;
    $('shortLinkDisplay').textContent=shortUrl;
    $('shortLinkResult').style.display='block';
    $('longURL').value='';
    if(aliasInput) aliasInput.value='';
    toast('Short link created!','success');
    loadLinks();
    loadDashStats();
  } catch(e){ loader(false); toast('Error creating link','error'); }
}

function copyShortLink(){
  const url=$('shortLinkDisplay').textContent;
  navigator.clipboard.writeText(url).then(()=>toast('Copied to clipboard!','success')).catch(()=>toast('Could not copy','error'));
}

function makeQRFromLink(){
  const url=$('shortLinkDisplay').textContent;
  showPanel('qr');
  $('qrURL').value=url;
  setQRType('url',document.querySelector('.qr-type-btn'));
  regenerateQR();
}

async function loadLinks(){
  if(!currentUser) return;
  try{
    const snap=await db.collection('shortlinks').where('userId','==',currentUser.uid).orderBy('createdAt','desc').get();
    const items=[];
    snap.forEach(d=>items.push({id:d.id,...d.data()}));
    $('linkCountBadge').textContent=`${items.length} link${items.length!==1?'s':''}`;
    renderLinksList(items);
  } catch(e){}
}

function renderLinksList(items){
  const el=$('linksList');
  if(!el) return;
  if(!items.length){ el.innerHTML='<div class="empty"><div class="empty-icon">üîó</div><p>No links yet</p></div>'; return; }
  const base=location.origin+location.pathname;
  el.innerHTML=items.map(l=>`
    <div class="link-item">
      <h4 title="${l.originalUrl}">${l.originalUrl.slice(0,50)}‚Ä¶</h4>
      <div class="short"><span style="color:var(--primary-light);">‚ö°</span> ${base}#/r/${l.code} <span style="cursor:pointer;" onclick="navigator.clipboard.writeText('${base}#/r/${l.code}').then(()=>toast('Copied!','success'))">üìã</span></div>
      <div class="link-meta"><span>Clicks: ${l.clicks||0}</span><span>${timeAgo(l.createdAt)}</span></div>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ‚îÄ Notifications ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadNotifications(){
  if(!currentUser) return;
  try{
    const snap=await db.collection('notifications').orderBy('createdAt','desc').limit(30).get();
    const items=[];
    snap.forEach(d=>items.push({id:d.id,...d.data()}));
    // Filter by plan
    const plan=userDoc&&userDoc.plan||'free';
    const filtered=items.filter(n=>!n.target||n.target==='all'||(n.target==='free'&&plan==='free')||(n.target==='premium'&&plan==='premium'));
    // Get read status
    const readSnap=await db.collection('user_reads').doc(currentUser.uid).get();
    const readIds=readSnap.exists?(readSnap.data().ids||[]):[];
    const unread=filtered.filter(n=>!readIds.includes(n.id)).length;
    if(unread>0){
      const badge=$('notifBadge'); if(badge){badge.textContent=unread; badge.classList.remove('hidden');}
      const dot=$('notifDot'); if(dot) dot.classList.remove('hidden');
    }
    const el=$('notifList');
    if(!el) return;
    if(!filtered.length){ el.innerHTML='<div class="empty"><div class="empty-icon">üîî</div><p>No notifications yet</p></div>'; return; }
    const typeIcon={info:'‚ÑπÔ∏è',upgrade:'‚≠ê',feature:'üéâ',warning:'‚ö†Ô∏è',system:'üîß'};
    el.innerHTML=filtered.map(n=>{
      const isUnread=!readIds.includes(n.id);
      return `<div class="notif-item ${isUnread?'unread':''}" onclick="markRead('${n.id}')"><div class="notif-dot ${isUnread?'':'read'}"></div><div><h4>${typeIcon[n.type]||'üì¢'} ${n.title}</h4><p>${n.message}</p><div class="notif-time">${timeAgo(n.createdAt)}</div></div></div>`;
    }).join('');
  } catch(e){}
}

async function markRead(id){
  if(!currentUser) return;
  try{
    await db.collection('user_reads').doc(currentUser.uid).set({ids:firebase.firestore.FieldValue.arrayUnion(id)},{merge:true});
    loadNotifications();
  } catch(e){}
}

// ‚îÄ‚îÄ‚îÄ AI Chat ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const AI_KB = [
  {p:['hello','hi','hey','hii','hiya','good morning','good afternoon','good evening'],r:"Hi there! üëã I'm Trisend AI Assistant. I'm here to help you with QR codes, link shortening, analytics, your account, and anything Trisend. What can I help you with today?"},
  {p:['premium','upgrade','plan','price','cost','how much','‚Ç¶'],r:"Trisend Premium is a one-time payment of just **‚Ç¶2,000** ‚Äî that means you pay once and get lifetime access forever! üéâ\n\nPremium unlocks:\n‚Ä¢ Custom QR colors & backgrounds\n‚Ä¢ Rounded, dots QR pixel shapes\n‚Ä¢ Logo embedding in QR codes\n‚Ä¢ Beautiful QR frames\n‚Ä¢ Custom short link aliases\n‚Ä¢ Unlimited QR codes & links\n‚Ä¢ Advanced analytics\n\nClick **'Upgrade to Premium'** in the sidebar to get started. It takes less than 2 minutes! üöÄ"},
  {p:['qr','qr code','generate','create qr','make qr'],r:"Creating a QR code with Trisend is super easy! Here's how:\n\n1. Click **QR Generator** in the left sidebar\n2. Choose your QR type: URL, Text, WiFi, Contact, Email, Phone, SMS, or Location\n3. Enter your content\n4. Customize (Premium: colors, shapes, logo, frames)\n5. Download or save your QR code!\n\nYour QR codes are tracked automatically ‚Äî you can see scan counts in **Analytics**. üìä"},
  {p:['short link','shorten','link','url shortener','short url'],r:"Shortening links with Trisend is instant! Here's how:\n\n1. Go to **Short Links** in the sidebar\n2. Paste your long URL\n3. (Premium) Add a custom alias like `yourname`\n4. Click **Shorten Link**\n5. Copy and share your short link!\n\nEvery click is tracked in **Analytics**. Free users get 20 links, Premium gets unlimited! üîó"},
  {p:['analytics','stats','statistics','scans','clicks','track'],r:"Trisend Analytics tracks everything automatically! üìä\n\n‚Ä¢ **QR Scans** ‚Äî every time someone scans your QR code\n‚Ä¢ **Link Clicks** ‚Äî every click on your short links\n‚Ä¢ **Performance charts** ‚Äî see which QR/links perform best\n\nGo to the **Analytics** section in the sidebar to see your full dashboard. Premium users get more detailed insights!"},
  {p:['free','free plan','what\'s free','free features'],r:"The **Free plan** on Trisend includes:\n\n‚úÖ Up to 10 QR codes\n‚úÖ Up to 20 short links\n‚úÖ Basic analytics (scan & click counts)\n‚úÖ Standard QR styles (black & white)\n‚úÖ All QR types (URL, WiFi, Contact, etc.)\n\n‚ùå Custom colors, shapes, logos, frames\n‚ùå Custom link aliases\n‚ùå Unlimited codes & links\n\nUpgrade to **Premium for ‚Ç¶2,000** (one-time!) to unlock everything! ‚≠ê"},
  {p:['download','png','save','export'],r:"To download your QR code:\n\n1. Go to **QR Generator** and create your QR\n2. Click the **‚¨á Download PNG** button\n3. Your QR code will download as a high-quality PNG file!\n\nYou can also click **üíæ Save QR Code** to save it to your Trisend account and track scans. üìÅ"},
  {p:['logo','add logo','logo in qr'],r:"Adding a logo to your QR code is a **Premium feature** ‚≠ê\n\nHere's how to use it:\n1. Upgrade to Premium (‚Ç¶2,000 one-time)\n2. Go to **QR Generator**\n3. Scroll down to **Logo** in the customization panel\n4. Upload your PNG or JPG logo file\n5. Your logo will appear in the center of the QR code!\n\nTip: Use a white background PNG for best results. Make sure to set error correction to **High (30%)** when adding logos!"},
  {p:['color','colour','change color','custom color'],r:"Custom QR colors are a **Premium feature** ‚≠ê\n\nWith Premium, you can:\n‚Ä¢ Change the **foreground** (dot) color to any color\n‚Ä¢ Change the **background** color\n‚Ä¢ Create branded QR codes that match your colors!\n\nUpgrade for ‚Ç¶2,000 (one-time) to unlock this! üé®"},
  {p:['wifi','wi-fi','wireless','network'],r:"You can create a **WiFi QR code** so people can join your network just by scanning! üì∂\n\nHere's how:\n1. Go to **QR Generator**\n2. Select **WiFi** as the QR type\n3. Enter your Network Name (SSID), Password, and Security type\n4. Generate and download/print your QR code!\n\nPerfect for cafes, offices, homes, and events! ‚òï"},
  {p:['contact','vcard','business card'],r:"Trisend can create a **Contact/vCard QR code** that adds someone's contact info when scanned! üë§\n\n1. Go to **QR Generator**\n2. Select **Contact**\n3. Fill in Name, Phone, Email, and Organization\n4. Generate your QR code!\n\nPerfect for business cards, name tags, and events. Share your contact info instantly! üíº"},
  {p:['support','help','contact','email','problem','issue'],r:"We're here to help! üí™\n\n‚Ä¢ **Email:** trisendmailer@gmail.com\n‚Ä¢ **AI Chat:** You're already here! Ask me anything.\n‚Ä¢ **Bug Report:** Go to Settings ‚Üí Report a Bug\n\nOur team typically responds within 24 hours. For instant answers, just keep chatting with me! üòä"},
  {p:['bug','broken','not working','error','problem'],r:"Sorry to hear something isn't working! üôÅ\n\nHere's what to do:\n1. Try refreshing the page first\n2. Go to **Settings** ‚Üí **Report a Bug** to file a report\n3. Email us at **trisendmailer@gmail.com** with details\n4. Our team will investigate and fix it ASAP!\n\nCan you describe the issue and I'll see if I can help further? üîß"},
  {p:['frame','border','qr frame'],r:"QR frames are a stylish way to present your codes! They add a decorative border around your QR code.\n\nTrisend offers **4 frame styles** (Premium ‚≠ê):\nüü™ Purple solid border\nüü¶ Cyan dashed border\nüü® Gold thick border\n‚¨õ Dark shadow style\n\nUpgrade to Premium for ‚Ç¶2,000 to unlock QR frames! üñºÔ∏è"},
  {p:['delete','remove','how to delete'],r:"Currently, QR codes and links are managed through the Analytics section. You can view all your created items there.\n\nFor account deletion or removing specific items, please email **trisendmailer@gmail.com** and our team will assist you within 24 hours. üìß"},
  {p:['trisend','what is','about','platform'],r:"**Trisend** is a powerful QR code and short link generator platform. üöÄ\n\nHere's what we offer:\n‚Ä¢ ‚ö° Instant QR code generation (8+ types)\n‚Ä¢ üîó Smart link shortening with tracking\n‚Ä¢ üìä Real-time analytics\n‚Ä¢ üé® Custom branding (Premium)\n‚Ä¢ ü§ñ AI assistant (that's me!)\n‚Ä¢ üîî Platform notifications\n\nWe're designed for creators, businesses, and individuals who want to share smarter. Questions? Just ask! üòä"},
  {p:['logout','log out','sign out'],r:"To log out of Trisend:\n1. Scroll to the bottom of the left sidebar\n2. Click the **üö™ Log Out** button\n\nYou'll be taken back to the landing page. Your data is safely saved and ready when you come back! See you soon! üëã"},
  {p:['paystack','payment','pay','how to pay'],r:"Trisend uses **Paystack** for secure payments ‚Äî one of Africa's most trusted payment processors! üîí\n\n**How to upgrade:**\n1. Click **Upgrade to Premium** in the sidebar\n2. Click the **üöÄ Upgrade for ‚Ç¶2,000** button\n3. A Paystack popup will appear\n4. Pay with card, bank transfer, or USSD\n5. Your account is instantly upgraded!\n\nAll transactions are SSL encrypted and secure. ‚úÖ"},
  {p:['thank','thanks','thank you','great','awesome','amazing'],r:"You're so welcome! üòä Happy to help! If you have any more questions or need help with anything on Trisend, I'm always here. Happy creating! üöÄ‚≠ê"},
];

let chatHistory = [];

function getAIResponse(msg){
  const lower=msg.toLowerCase();
  for(const kb of AI_KB){
    if(kb.p.some(p=>lower.includes(p))) return kb.r;
  }
  // Fallback responses
  const fallbacks=[
    "That's a great question! I don't have a specific answer for that, but you can reach our team at **trisendmailer@gmail.com** and they'll help you out. üìß",
    "Hmm, I'm not sure about that one! For detailed help, email **trisendmailer@gmail.com**. Is there anything else about Trisend I can help with? üòä",
    "I don't have enough info to answer that perfectly. Try reaching out to our support team at **trisendmailer@gmail.com** ‚Äî they're super helpful! üôå"
  ];
  return fallbacks[Math.floor(Math.random()*fallbacks.length)];
}

function formatAIMessage(text){
  return text
    .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
    .replace(/\n/g,'<br>');
}

function handleChatKey(e){
  if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); sendChat(); }
}

async function sendChat(){
  const input=$('chatInput');
  const msg=input.value.trim();
  if(!msg) return;
  input.value='';
  const container=$('chatMessages');
  // User message
  container.innerHTML+=`<div class="chat-msg user fade-in"><div class="chat-avatar">üë§</div><div class="chat-bubble">${msg}</div></div>`;
  // Typing
  const typingId='typing-'+Date.now();
  container.innerHTML+=`<div class="chat-msg bot" id="${typingId}"><div class="chat-avatar">ü§ñ</div><div class="chat-bubble"><div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div></div>`;
  container.scrollTop=container.scrollHeight;
  chatHistory.push({role:'user',content:msg});
  // Simulate thinking
  await new Promise(r=>setTimeout(r,800+Math.random()*800));
  const reply=getAIResponse(msg);
  const typingEl=document.getElementById(typingId);
  if(typingEl) typingEl.remove();
  container.innerHTML+=`<div class="chat-msg bot fade-in"><div class="chat-avatar">ü§ñ</div><div class="chat-bubble">${formatAIMessage(reply)}</div></div>`;
  chatHistory.push({role:'assistant',content:reply});
  container.scrollTop=container.scrollHeight;
  // Save to Firestore
  if(currentUser){
    try{
      await db.collection('ai_chats').doc(currentUser.uid).set({
        userId:currentUser.uid,
        email:currentUser.email,
        displayName:userDoc&&userDoc.displayName||currentUser.displayName,
        messages:chatHistory.slice(-30),
        updatedAt:firebase.firestore.FieldValue.serverTimestamp()
      },{merge:true});
    } catch(e){}
  }
}

// ‚îÄ‚îÄ‚îÄ Settings ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function saveSettings(){
  if(!currentUser) return;
  const name=$('settingsName').value.trim();
  if(!name){ toast('Enter a display name','error'); return; }
  loader(true);
  try{
    await db.collection('users').doc(currentUser.uid).update({displayName:name});
    await currentUser.updateProfile({displayName:name});
    userDoc.displayName=name;
    $('sidebarName').textContent=name;
    loader(false);
    toast('Settings saved!','success');
  } catch(e){ loader(false); toast(e.message,'error'); }
}

async function submitBug(){
  if(!currentUser){ toast('Please log in','error'); return; }
  const title=$('bugTitle').value.trim(), desc=$('bugDesc').value.trim();
  if(!title||!desc){ toast('Please fill in both fields','error'); return; }
  try{
    await db.collection('bugs').add({
      userId:currentUser.uid, email:currentUser.email,
      title, description:desc, status:'open',
      createdAt:firebase.firestore.FieldValue.serverTimestamp()
    });
    $('bugTitle').value=''; $('bugDesc').value='';
    toast('Bug report submitted! We\'ll look into it.','success');
  } catch(e){ toast('Error submitting report','error'); }
}

// ‚îÄ‚îÄ‚îÄ Paystack ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initiatePayment(){
  if(!currentUser){ toast('Please log in first','error'); return; }
  if(userDoc&&userDoc.plan==='premium'){ toast('You already have Premium!','info'); return; }
  const handler=PaystackPop.setup({
    key:PAYSTACK_PK,
    email:currentUser.email,
    amount:200000, // ‚Ç¶2,000 in kobo
    currency:'NGN',
    ref:'TRISEND-'+Date.now()+'-'+currentUser.uid.slice(0,8),
    metadata:{userId:currentUser.uid,email:currentUser.email},
    callback:async(response)=>{
      loader(true);
      try{
        await db.collection('users').doc(currentUser.uid).update({
          plan:'premium',
          paystackRef:response.reference,
          upgradedAt:firebase.firestore.FieldValue.serverTimestamp()
        });
        userDoc.plan='premium';
        loader(false);
        toast('üéâ Welcome to Premium! All features unlocked!','success');
        enablePremiumFeatures();
        const planBadge=$('sidebarPlan');
        planBadge.className='sidebar-plan plan-premium';
        planBadge.textContent='‚≠ê Premium';
        hide('upgradeBanner');
        $('upgradeNavItem').style.display='none';
        showPanel('home');
      } catch(e){ loader(false); toast('Payment verified but upgrade failed. Contact support.','error'); }
    },
    onClose:()=>{ toast('Payment cancelled','info'); }
  });
  handler.openIframe();
}

// ‚îÄ‚îÄ‚îÄ Admin Dashboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function showAdminDash(){
  hide('landing'); hide('dashboard');
  show('admin');
  hide('globalLoader');
  $('adminUserEmail').textContent=currentUser?.email||'';
  loadAdminOverview();
  loadAdminUsers();
  loadAdminNotifHistory();
  loadAdminChats();
  loadAdminBugs();
}

function showAdminPanel(p){
  document.querySelectorAll('.admin-panel').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.admin-sidebar .nav-item').forEach((el,i)=>el.classList.toggle('active',i===['overview','users','notifications','chats','bugs','system'].indexOf(p)));
  const panel=$(`apanel-${p}`);
  if(panel) panel.classList.add('active');
}

async function loadAdminOverview(){
  try{
    const [usersSnap,qrSnap,linkSnap,bugsSnap]=await Promise.all([
      db.collection('users').get(),
      db.collection('qrcodes').get(),
      db.collection('shortlinks').get(),
      db.collection('bugs').where('status','==','open').get()
    ]);
    const users=[]; usersSnap.forEach(d=>users.push({id:d.id,...d.data()}));
    const premiumCount=users.filter(u=>u.plan==='premium').length;
    $('adStatUsers').textContent=usersSnap.size;
    $('adStatPremium').textContent=premiumCount;
    $('adStatQRTotal').textContent=qrSnap.size;
    $('adStatLinksTotal').textContent=linkSnap.size;
    $('adStatRevenue').textContent=`‚Ç¶${(premiumCount*2000).toLocaleString()}`;
    $('adStatBugs').textContent=bugsSnap.size;
    allUsers=users;
    const recent=users.sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0)).slice(0,5);
    $('recentSignups').innerHTML=recent.length?recent.map(u=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border2);"><div><div style="font-size:13px;font-weight:600;">${u.displayName||'User'}</div><div style="font-size:11px;color:var(--text3);">${u.email}</div></div><span class="badge badge-${u.plan==='premium'?'premium':'free'}">${u.plan}</span></div>`).join(''):'<p style="color:var(--text3);font-size:13px;">No users yet</p>';
    renderUsersTable(users);
  } catch(e){ console.log(e); }
}

async function loadAdminUsers(){
  if(!allUsers.length) await loadAdminOverview();
  renderUsersTable(allUsers);
}

function renderUsersTable(users){
  const tbody=$('usersTable');
  if(!tbody) return;
  if(!users.length){ tbody.innerHTML='<tr><td colspan="6" style="text-align:center;color:var(--text3);">No users found</td></tr>'; return; }
  tbody.innerHTML=users.map(u=>`
    <tr>
      <td style="font-weight:500;">${u.displayName||'‚Äî'}</td>
      <td style="color:var(--text2);">${u.email||'‚Äî'}</td>
      <td><span class="badge badge-${u.plan==='premium'?'premium':'free'}">${u.plan==='premium'?'‚≠ê Premium':'Free'}</span></td>
      <td><span class="badge ${u.role==='admin'?'badge-admin':'badge-free'}">${u.role||'user'}</span></td>
      <td style="color:var(--text3);">${timeAgo(u.createdAt)}</td>
      <td>
        ${u.plan!=='premium'?`<button class="btn btn-green btn-sm" onclick="adminGrantPremium('${u.id}')">‚≠ê Premium</button>`:`<button class="btn btn-ghost btn-sm" onclick="adminRevokePremium('${u.id}')">Revoke</button>`}
      </td>
    </tr>
  `).join('');
}

function filterUsers(){
  const q=$('userSearch').value.toLowerCase();
  const filtered=allUsers.filter(u=>(u.email||'').toLowerCase().includes(q)||(u.displayName||'').toLowerCase().includes(q));
  renderUsersTable(filtered);
}

async function adminGrantPremium(uid){
  loader(true);
  try{
    await db.collection('users').doc(uid).update({plan:'premium',upgradedAt:firebase.firestore.FieldValue.serverTimestamp(),manualUpgrade:true});
    loader(false); toast('Premium granted!','success');
    await loadAdminOverview();
  } catch(e){ loader(false); toast('Error','error'); }
}

async function adminRevokePremium(uid){
  loader(true);
  try{
    await db.collection('users').doc(uid).update({plan:'free'});
    loader(false); toast('Premium revoked','info');
    await loadAdminOverview();
  } catch(e){ loader(false); toast('Error','error'); }
}

async function sendAdminNotif(){
  const title=$('ntTitle').value.trim(), msg=$('ntMsg').value.trim(), type=$('ntType').value, target=$('ntTarget').value;
  if(!title||!msg){ toast('Fill in title and message','error'); return; }
  loader(true);
  try{
    await db.collection('notifications').add({
      title,message:msg,type,target,
      createdAt:firebase.firestore.FieldValue.serverTimestamp(),
      sentBy:currentUser.uid
    });
    loader(false); toast('Notification sent!','success');
    $('ntTitle').value=''; $('ntMsg').value='';
    loadAdminNotifHistory();
  } catch(e){ loader(false); toast('Error','error'); }
}

async function loadAdminNotifHistory(){
  try{
    const snap=await db.collection('notifications').orderBy('createdAt','desc').limit(20).get();
    const items=[]; snap.forEach(d=>items.push({id:d.id,...d.data()}));
    const el=$('notifHistory');
    if(!el) return;
    el.innerHTML=items.length?items.map(n=>`<div style="padding:10px;border-bottom:1px solid var(--border2);"><div style="font-size:13px;font-weight:600;">${n.title}</div><div style="font-size:11px;color:var(--text3);">${n.target||'all'} ‚Ä¢ ${timeAgo(n.createdAt)}</div></div>`).join(''):'<p style="color:var(--text3);font-size:13px;">No notifications sent yet</p>';
  } catch(e){}
}

async function loadAdminChats(){
  try{
    const snap=await db.collection('ai_chats').orderBy('updatedAt','desc').limit(30).get();
    const items=[]; snap.forEach(d=>items.push({id:d.id,...d.data()}));
    const el=$('chatUserList');
    if(!el) return;
    el.innerHTML=items.length?items.map(c=>`<div style="padding:10px;border-bottom:1px solid var(--border2);cursor:pointer;border-radius:6px;transition:.2s;" onmouseover="this.style.background='rgba(255,255,255,.04)'" onmouseout="this.style.background=''" onclick="viewUserChat(${JSON.stringify(c).replace(/"/g,'&quot;')})"><div style="font-size:13px;font-weight:600;">${c.displayName||'User'}</div><div style="font-size:11px;color:var(--text3);">${c.email||c.id} ‚Ä¢ ${timeAgo(c.updatedAt)}</div></div>`).join(''):'<p style="color:var(--text3);font-size:13px;">No conversations yet</p>';
  } catch(e){}
}

function viewUserChat(chat){
  $('viewingChatTitle').textContent=`${chat.displayName||'User'}'s Conversation`;
  const msgs=chat.messages||[];
  const el=$('adminChatView');
  el.innerHTML=msgs.map(m=>`<div style="margin-bottom:10px;text-align:${m.role==='user'?'right':'left'};"><div style="display:inline-block;background:${m.role==='user'?'var(--grad)':'rgba(124,58,237,.12)'};border:1px solid var(--border);border-radius:10px;padding:8px 12px;font-size:13px;max-width:80%;text-align:left;">${formatAIMessage(m.content)}</div></div>`).join('');
  el.scrollTop=el.scrollHeight;
}

async function loadAdminBugs(){
  try{
    const snap=await db.collection('bugs').orderBy('createdAt','desc').get();
    const items=[]; snap.forEach(d=>items.push({id:d.id,...d.data()}));
    const tbody=$('bugsTable');
    if(!tbody) return;
    tbody.innerHTML=items.length?items.map(b=>`
      <tr>
        <td style="font-weight:500;">${b.title}</td>
        <td style="color:var(--text2);">${b.email||b.userId?.slice(0,8)||'‚Äî'}</td>
        <td><span class="badge badge-${b.status==='open'?'open':'resolved'}">${b.status}</span></td>
        <td style="color:var(--text3);">${timeAgo(b.createdAt)}</td>
        <td>${b.status==='open'?`<button class="btn btn-green btn-sm" onclick="resolveBug('${b.id}')">‚úÖ Resolve</button>`:'<span style="color:var(--text3);font-size:12px;">Resolved</span>'}</td>
      </tr>
    `).join(''):'<tr><td colspan="5" style="text-align:center;color:var(--text3);">No bug reports</td></tr>';
  } catch(e){}
}

async function resolveBug(id){
  try{
    await db.collection('bugs').doc(id).update({status:'resolved'});
    toast('Bug marked as resolved','success'); loadAdminBugs();
  } catch(e){ toast('Error','error'); }
}

async function saveSystemSettings(){
  toast('System settings saved!','success');
}

async function sendReminder(){
  const msg=$('reminderMsg').value.trim();
  if(!msg){ toast('Write a reminder message first','error'); return; }
  loader(true);
  try{
    await db.collection('notifications').add({
      title:'üí° Upgrade Reminder',message:msg,type:'upgrade',target:'free',
      createdAt:firebase.firestore.FieldValue.serverTimestamp(),
      sentBy:currentUser.uid
    });
    loader(false); toast('Upgrade reminder sent to all free users!','success');
  } catch(e){ loader(false); toast('Error','error'); }
}

async function grantPremium(){
  const email=$('grantEmail').value.trim();
  if(!email){ toast('Enter an email','error'); return; }
  loader(true);
  try{
    const snap=await db.collection('users').where('email','==',email).get();
    if(snap.empty){ loader(false); toast('User not found','error'); return; }
    const uid=snap.docs[0].id;
    await db.collection('users').doc(uid).update({plan:'premium',manualUpgrade:true,upgradedAt:firebase.firestore.FieldValue.serverTimestamp()});
    loader(false); toast(`Premium granted to ${email}!`,'success');
    $('grantEmail').value='';
    loadAdminOverview();
  } catch(e){ loader(false); toast('Error: '+e.message,'error'); }
}

async function grantAdmin(){
  const email=$('adminGrantEmail').value.trim();
  if(!email){ toast('Enter an email','error'); return; }
  loader(true);
  try{
    const snap=await db.collection('users').where('email','==',email).get();
    if(snap.empty){ loader(false); toast('User not found','error'); return; }
    await db.collection('users').doc(snap.docs[0].id).update({role:'admin'});
    loader(false); toast(`Admin role granted to ${email}!`,'success');
    $('adminGrantEmail').value='';
  } catch(e){ loader(false); toast('Error: '+e.message,'error'); }
}

// ‚îÄ‚îÄ‚îÄ Handle short link redirect on load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.addEventListener('hashchange',()=>{
  const hash=location.hash;
  if(hash.startsWith('#/r/') && !currentUser){
    handleRedirect(hash.replace('#/r/',''));
  }
});

// Initial load
(()=>{
  const hash=location.hash;
  if(hash.startsWith('#/r/')){
    handleRedirect(hash.replace('#/r/',''));
  }
})();
</script>
</body>
</html>